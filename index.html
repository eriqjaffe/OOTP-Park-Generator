<!DOCTYPE HTML>
<meta charset="utf-8">
<html>
<head>
    <title>OOTP Park Generator</title>
    <link rel="icon" type="image/png" href="./images/favicon.png">
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script type="text/javascript" src="./scripts/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="./scripts/spectrum.js"></script>
    <script type="text/javascript" src="./scripts/jquery.browser.min.js"></script>
    <script type="text/javascript" src="./scripts/jquery.magnific-popup.min.js"></script>
    <script type="text/javascript" src="./scripts/jquery.fileDownload.js"></script>
    <script type="text/javascript" src="./scripts/fabric16.js"></script>
    <script type="text/javascript" src="./scripts/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="./scripts/spin.min.js"></script>
    <script>
        const { ipcRenderer } = require('electron');
        const params = new URLSearchParams(window.location.search)
		const port = params.get('port')

        var doc = document.documentElement;
        doc.setAttribute('data-useragent', navigator.userAgent);

        var x0 = 300;
        var y0 = 482;
        
        var broadcastPlayerDefenseArray = {"Pitcher":{"x":368,"y":300,"short":"P"},"Catcher":{"x":500,"y":300,"short":"C"},"First Baseman":{"x":310,"y":520,"short":"a1B"},"Second Baseman":{"x":240,"y":411,"short":"a2B"},"Shortstop":{"x":240,"y":179,"short":"SS"},"Third Baseman":{"x":310,"y":80,"short":"a3B"},"Left Fielder":{"x":160,"y":100,"short":"LF"},"Center Fielder":{"x":95,"y":300,"short":"CF"},"Right Fielder":{"x":160,"y":500,"short":"RF"}};
        
        var broadcastPlayerOffenseArray = {"Runner on 1st":{"x":355,"y":520,"short":"R1"},"Runner on 2nd":{"x":292,"y":300,"short":"R2"},"Runner on 3rd":{"x":355,"y":80,"short":"R3"},"Lefty Batter":{"x":435,"y":415,"short":"LHB"},"Righty Batter":{"x":435,"y":175,"short":"RHB"}};
        
        var webcastPlayerArray = {"Pitcher":{"x":383,"y":240,"short":"P"},"Catcher":{"x":487,"y":240,"short":"C"},"First Baseman":{"x":342,"y":372,"short":"a1B"},"Second Baseman":{"x":279,"y":325,"short":"a2B"},"Shortstop":{"x":279,"y":152,"short":"SS"},"Third Baseman":{"x":342,"y":109,"short":"a3B"},"Left Fielder":{"x":192,"y":101,"short":"LF"},"Center Fielder":{"x":132,"y":240,"short":"CF"},"Right Fielder":{"x":192,"y":382,"short":"RF"},"Runner on 1st":{"x":383,"y":380,"short":"R1"},"Runner on 2nd":{"x":310,"y":240,"short":"R2"},"Runner on 3rd":{"x":383,"y":102,"short":"R3"},"Lefty Batter":{"x":455,"y":308,"short":"LHB"},"Righty Batter":{"x":455,"y":170,"short":"RHB"}};
        
        var staticBallLocationArray = {"x13":{"x":268,"y":414},"x13S":{"x":321,"y":437},"x15":{"x":332,"y":414},"x15S":{"x":279,"y":437},"x23":{"x":329,"y":448},"x25":{"x":271,"y":448},"x2L":{"x":290,"y":471},"x2R":{"x":310,"y":471},"x3":{"x":377,"y":390},"x34":{"x":364,"y":357},"x34D":{"x":390,"y":326},"x34S":{"x":340,"y":396},"x3D":{"x":406,"y":356},"x3L":{"x":378,"y":404},"x3S":{"x":345,"y":428},"x4":{"x":336,"y":347},"x4D":{"x":348,"y":303},"x4M":{"x":313,"y":333},"x4MD":{"x":317,"y":293},"x4MS":{"x":310,"y":372},"x4S":{"x":327,"y":381},"x5":{"x":223,"y":390},"x56":{"x":236,"y":357},"x56D":{"x":210,"y":326},"x56S":{"x":260,"y":396},"x5D":{"x":194,"y":356},"x5L":{"x":222,"y":404},"x5S":{"x":255,"y":428},"x6":{"x":264,"y":347},"x6D":{"x":252,"y":303},"x6M":{"x":287,"y":333},"x6MD":{"x":283,"y":293},"x6MS":{"x":290,"y":372},"x6S":{"x":273,"y":381},"xHP":{"x":x0,"y":y0}};

            //FOUL COORDINATES, TO BE DETERMINED
            //"2LF":{"x":238,"y":474},"23F":{"x":371,"y":437},"25F":{"x":212,"y":438},"3DF":{"x":453,"y":352},"3F":{"x":436,"y":382},"3SF":{"x":404,"y":410},"5DF":{"x":128,"y":351},"5F":{"x":150,"y":381},"5SF":{"x":184,"y":411},"2F":{"x":295,"y":533}
        
    </script>
    <link href='http://fonts.googleapis.com/css?family=Crete+Round|Archivo+Narrow:400,700' rel='stylesheet' type='text/css'>
    <link href='./scripts/parkgen.css' rel='stylesheet' type='text/css'>
    <link href='./scripts/spectrum.css' rel='stylesheet' type='text/css'>
    <link href='./scripts/magnific-popup.css' rel='stylesheet' type='text/css'>
    <!--[if IE]>
        <style type="text/css">
        .sample {
        filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='sample_600x600.png', sizingMethod='scale');
        background:none !important;
        }
        </style>
    <![endif]-->
</head>
<body>
    <div class="overlay" id="spinner">
        <div class="pleaseWait"></div>
    </div>
    <form id="ballparkInformation">
        <div class="col span_1_of_4">
            <fieldset class="coordToggle">
                <legend>Basic Information</legend>
                <table style="width:100%;">
                    <tr>
                        <td style="width:33%;">Park Name:</td>
                        <td style="width:66%;">
                            <span id="tb_cont">
                                <input name="ballparkName" id="ballparkName" type="text" placeholder="Unnamed Ballpark"></input>
                                <span title="Generate A Random Park Name"id="randomName"></span>
                            </span>
                            
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">Country:</td>
                        <td style="width:66%;">
                            <select name="ballparkCountry" id="ballparkCountry" placeholder="Select a Country"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">State/Province:</td>
                        <td style="width:66%;">
                            <select name="ballparkState" id="ballparkState" disabled placeholder="Select a State"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">City:</td>
                        <td style="width:66%;">
                            <select name="ballparkCity" id="ballparkCity" disabled placeholder="Select a City"></select>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">Type:</td>
        </div>
        <td style="width:66%;">
            <select class="recalculate randomizer" name="ballparkType" id="ballparkType">
                <option value="1" selected>Open Ballpark</option>
                <option value="2">Retractable Roof</option>
                <option value="3">Dome</option>
            </select>
        </td>
        </tr>
        <tr>
            <td style="width:33%;">Surface:</td>
            </div>
            <td style="width:66%;">
                <select class="regenerate recalculate randomizer" name="ballparkSurface" id="ballparkSurface">
                    <option value="AT">Artificial Turf</option>
                    <option value="ATDI">Artificial Turf w/Dirt Infield</option>
                    <option value="ATGO">Artificial Turf w/Grass Outfield</option>
                    <option value="DIRT">Dirt</option>
                    <option value="DGA">Dirt w/Grass Oufield</option>
                    <option value="FIELD">Field</option>
                    <option value="FT">Field Turf</option>
                    <option value="GRASS">Grass</option>
                    <option value="LAWN">Lawn</option>
                    <option value="MG" selected>Manicured Grass</option>
                </select>
            </td>
        </tr>
        <tr>
            <td style="width:33%;">Foul Area:</td>
            <td style="width:66%;">
                <select class="regenerate recalculate randomizer" id="ballparkFoulArea" name="ballparkFoulArea">
                    <option value="-4">Extra Small</option>
                    <option value="-3">Small</option>
                    <option value="0" selected>Average</option>
                    <option value="2">Large</option>
                    <option value="3">Very Large</option>
                    <option value="4">Extra Large</option>
                </select>
            </td>
        </tr>
        <tr>
            <td style="width:33%;">Altitude:</td>
            <td style="width:66%;">
                <input class="recalculate center genericNumber" id="ballparkAltitude" name="ballparkAltitude" type="number" value="0"></input>
            </td>
        </tr>
        <tr>
            <td style="width:33%;">Capacity:</td>
            <td style="width:66%;">
                <input class="number center genericNumber" id="ballparkCapacity" name="ballparkCapacity" type="number" value="42880"></input>
            </td>
        </tr>
        </table>
        </fieldset>
        <br>
        <fieldset>
            <legend>Ballpark Dimensions</legend>
            <table style="width:100%;">
                <tr>
                    <td style="width:33%;">&nbsp;</td>
                    <td style="width:33%; text-align:center;">Distance</td>
                    <td style="width:33%; text-align:center;">Wall Height</td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Left Field Line:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="leftLine" name="leftLine" type="number" value="330" style="width:99%;" data-location="Left Field Line"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="leftLineWall" name="leftLineWall" type="number" value="11" style="width:99%;" data-location="Left Field Line"></input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Left Field:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="leftField" name="leftField" type="number" value="360" style="width:99%;" data-location="Left Field"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="leftFieldWall" name="leftFieldWall" type="number" value="11" style="width:99%;" data-location="Left Field"></input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Left Center:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="leftCenter" name="leftCenter" type="number" value="390" style="width:99%;" data-location="Left Center"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="leftCenterWall" name="leftCenterWall" type="number" value="11" style="width:99%;" data-location="Left Center"></input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Center Field:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="centerField" name="centerField" type="number" value="405" style="width:99%;" data-location="Center Field"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="centerFieldWall" name="centerFieldWall" type="number" value="11" style="width:99%;" data-location="Center Field"></input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Right Center:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="rightCenter" name="rightCenter" type="number" value="390" style="width:99%;" data-location="Right Center"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="rightCenterWall" name="rightCenterWall" type="number" value="11" style="width:99%;" data-location="Right Center"</input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Right Field:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="rightField" name="rightField" type="number" value="360" style="width:99%;" data-location="Right Field"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="rightFieldWall" name="rightFieldWall" type="number" value="11" style="width:99%;" data-location="Right Field"></input>
                    </td>
                </tr>
                <tr>
                    <td style="width:33%;">
                        <label>Right Field Line:</label>
                    </td>
                    <td style="width:33%;">
                        <input class="regenerate recalculate center distance" id="rightLine" name="rightLine" type="number" value="330" style="width:99%;" data-location="Right Field Line"></input>
                    </td>
                    <td style="width:33%;">
                        <input class="recalculate center height" id="rightLineWall" name="rightLineWall" type="number" value="11" style="width:99%;" data-location="Right Field Line"></input>
                    </td>
                </tr>
            </table>
        </fieldset>
        <br>
        <fieldset>
            <legend>Actions</legend>
            <div class="formItem">
                <input class="button" type="button" id="randomPark" value="Generate Random Ballpark">
            </div>
            <div class="formItem">
                <input class="button" type="button" id="flipPark" value="Flip Ballpark">
            </div>
            <div class="formItem">
                <input type="file" id="uploadedPattern" accept="image/png" style="display:none;"/>
                <input class="button addMowPattern" type="button" value="Upload Mow Pattern" onclick="document.getElementById('uploadedPattern').click();">
            </div>
            <div class="formItem">
                <input type="file" id="uploadedImg" accept="image/*" style="display:none;"/>
                <input class="button" type="button" id="addImage" value="Add Field Image" onclick="document.getElementById('uploadedImg').click();">
            </div>
            <div class="formItem">
                <input class="button" type="button" id="showPlayers" value="Edit Player & Ball Locations">
            </div>
<!--             <div class="formItem">
                <input class="button" type="button" id="downloadPark" value="Save Ballpark">
            </div>
            <div class="formItem">
                <input type="file" id="loadPark" accept=".bpk" style="display:none;"/>
                <input class="button" type="button" id="uploadPark" value="Load Ballpark">
            </div> -->
			<div class="formItem">
                <input class="button" type="button" id="downloadParkOriginal" value="Download Ballpark">
            </div>
<!--             <div class="formItem" style="display:none;">
                <input class="button" type="button" id="cgiprk" value="cgi prk testing">
            </div>
            <div class="formItem" style="display:none;">
                <input class="button" type="button" id="phpprk" value="php prk testing">
            </div> -->
            <div class="formItem">
                <input class="buttonLast" type="button" id="reset" value="Reset Everything">
            </div>

        </fieldset>
        </div>
        <div class="col span_2_of_4">
            <div class="title">
                <span class="header">Welcome To The OOTP Park Generator</span>
            </div>
            <div class="formItem" style="width:100%; padding-top:10px;">
                <center>
                    <div id="container" style="width:100%; height:100%; max-width:600px; max-height:600px; position:relative;">
                        <fieldset class="factorHeader" style="pointer-events:none;">
                            <legend style="font-size:.8em;">Park Factors</legend>
                            <div class="section group">
                                <div class="col span_1_of_3">
                                    <label for="avgLHB">Average LHB:</label>
                                    <label class="factor" id="avgLHB"><b>test</b></label>
                                </div>
                                <div class="col span_1_of_3">
                                    <label for="doubles">Doubles:</label>
                                    <label class="factor" id="doubles"></label>
                                </div>
                                <div class="col span_1_of_3">
                                    <label for="hrLHB">Home Runs LHB:</label>
                                    <label class="factor" id="hrLHB"></label>
                                </div>
                            </div>
                            <div class="section group">
                                <div class="col span_1_of_3">
                                    <label for="avgRHB">Average RHB:</label>
                                    <label class="factor" id="avgRHB"></label>
                                </div>
                                <div class="col span_1_of_3">
                                    <label for="triples">Triples:</label>
                                    <label class="factor" id="triples"></label>
                                </div>
                                <div class="col span_1_of_3">
                                    <label for="hrRHB">Home Runs RHB:</label>
                                    <label class="factor" id="hrRHB"></label>
                                </div>
                            </div>
                            <input type="hidden" name="avgLHB" id="avgLHBform" value="">
                            <input type="hidden" name="avgRHB" id="avgRHBform" value="">
                            <input type="hidden" name="doubles" id="doublesform" value="">
                            <input type="hidden" name="triples" id="triplesform" value="">
                            <input type="hidden" name="hrLHB" id="hrLHBform" value="">
                            <input type="hidden" name="hrRHB" id="hrRHBform" value="">
                        </fieldset>
                        <fieldset class="factorFooter" id="factorFooter" style="margin-top:525px;">
                            <legend id="optionsTitle">Field Options</legend>
                            <div id="fieldOptionContainer">
                            <div class="fieldOption" id="mowPatternItem" style="display:inline-block;">
                                <table>
                                    <tr>
                                        <td>Mow Pattern:</td>
                                        <td>
                                            <select class="fieldOption randomizer" name="mowPattern" id="mow_pattern">
                                                <option value="./images/argyle2.png">Argyle</option>
                                                <option value="./images/chevron.png">Chevron</option>
                                                <option value="./images/cross_hatch.png">Cross-Hatched</option>
                                                <option value="./images/damask.png">Damask</option>
                                                <option value="./images/diamond_cross_hatch.png">Cross-Hatched Diamonds</option>
                                                <option value="./images/concentric_circles.png">Concentric Circles</option>
                                                <option value="./images/diamonds.png">Diamonds</option>
                                                <option value="./images/houndstooth.png">Houndstooth</option>
                                                <option value="./images/mountains.png">Mountains</option>
                                                <option value="./images/plaid2.png">Plaid</option>
                                                <option value="./images/rising_sun.png">Rising Sun</option>
                                                <option value="./images/seashell.png">Seashell</option>
                                                <option value="./images/skyline.png">Skyline</option>
                                                <option value="./images/starburst.png">Starburst</option>
                                                <option value="./images/straight_lines2.png" selected>Straight Lines</option>
                                                <option id="customMowPattern" value="">Custom</option>
                                                <option value="./images/blank600x600.png">None</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="fieldOption" id="pitchingLaneItem">
                                <table>
                                    <tr>
                                        <td>Pitching Lane</td>
                                        <td>
                                            <select class="fieldOption randomizer selectOption" name="pitchingLane" id="pitchingLane">
                                                <option value="off" selected>Off</option>
                                                <option value="on">On</option> -->
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="fieldOption" id="infieldTypeItem">
                                <table>
                                    <tr>
                                        <td>Infield Type:</td>
                                        <td>
                                            <select class="fieldOption randomizer selectOption" name="infieldType" id="infieldType">
                                                <option value="full">Dirt Infield</option>
                                                <option value="pits">Sliding Pits</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="fieldOption" id="distanceMarkersItem">
                                <table>
                                    <tr>
                                        <td>Distance Markers:</td>
                                        <td>
                                            <select name="distanceMarkers" class="selectOption" id="distanceMarkers">
                                                <option value="on">On</option>
                                                <option value="off" selected>Off</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div id="onDeckCirclesItem" id="onDeckCirclesItem" style="display:inline-block;">
                                <table>
                                    <tr>
                                        <td>On-Deck Circles:</td>
                                        <td>
                                            <select class="fieldOption randomizer selectOption" name="onDeckCircles" id="onDeckCircles">
                                                <option value="off">Off</option>
                                                <option value="on" selected>On</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            </div>
                            <div id="opacityControl" style="display:none;">
                                <table>
                                    <tr>
                                        <td>Opacity:</td>
                                        <td>
                                            <input type="button" class="button rangeButton" value="-">
                                            <input class="range" id="opacitySlider" value="0" min="0" max="100" type="range" style="width:50%;">
                                            <input type="button" class="button rangeButton" value="+">
                                            <span  class="sliderValue" id="opacityValue" style="margin-left:5px;"></span>%
                                        </td>
                                        <td><input type="button" class="button" id="centerImage" value="Center"></td>
                                        <td><input type="button" class="button" id="duplicateImage" value="Duplicate"></td>
                                        <td><input type="button" class="button rotate clockwise" id="clockwise"></td>
                                        <td><input type="button" class="button rotate counterclockwise" id="counterclockwise"></td>
                                    </tr>
                                </table>
                                <table style="width: 100%;">
                                    <tr>
                                    <td style="width:13%;"><center>
                                        <input type="button" id="colorSquare" class="colorSquare" value="Pick Color">
                                    </td>
                                    <td style="width:17%; text-align:center;">
                                        <span id="chosenCoordinates" style="margin-right:5px;">(X: , Y: )</span>
                                    </td>                                   
                                    <td style="width:65%; text-align:center;">
                                        Fuzz %:
                                        <input type="button" class="button rangeButton" value="-">
                                        <input type="range" class="range" id="colorFuzz" value="40" min="1" max="100" style="margin-left:5px; margin-right:5px; width:50%;">
                                        <input type="button" class="button rangeButton" value="+">
                                        <span class="sliderValue" id="fuzzAmount">40</span>%
                                    </td>
                                    </tr>
                                </table>
                                <table>
                                    <tr>
                                        <td style="width:20%;">
                                            <input type="button" class="button" id="border" value="Remove Border">
                                                </td>
                                        <td style="width:20%;">
                                            <input type="button" class="button removeColor" id="removeColorRange" value="Remove Section" data-x="0" data-y="0">
                                        </td><td style="width:20%;">
                                            <input type="button" class="button removeColor" id="removeAllColor" value="Remove All" data-x="0" data-y="0">
                                        </td><td style="width:20%;">
                                            <input type="button" class="button replaceColor" id="replaceColorRange" value="Replace Section" data-x="0" data-y="0">
                                        </td><td style="width:20%;">                                        
                                            <input type="button" class="button replaceColor" id="replaceAllColor" value="Replace All" data-x="0" data-y="0">
                                        </td>
                                    </tr>
                                </table>
                                <table>
                                    <tr>
                                        <td style="width:25%;">
                                        <input type="button" class="button resizeImage" id="outfieldLogo" value="Place In Outfield">
                                        </td>
                                        <td style="width:25%;">
                                        <input type="button" class="button resizeImage" id="plateLogo" value="Place Behind Plate">
                                        </td>
                                        <td style="width:25%;">
                                        <input type="button" class="button resizeImage" id="1bFoulLogo" value="1B Foul Area">
                                        </td>
                                        <td style="width:25%;">
                                        <input type="button" class="button resizeImage" id="3bFoulLogo" value="3B Foul Area">
                                        </td>
                                    </tr>
                                </table>
                                <div id="replaceColorDiv" style="display:none;">
                                    <table style="width:100%;"><tr>
                                        <td><center>
                                            Select Replacement Color:
                                            <input class="colorSelector" type="text" id="replacementColor" value="#FF0000">
                                            <input type="button" class="button" id="replaceColorSubmit" value="Replace Color" data-x="0" data-y="0" data-action="null">
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <div id="customMowPatternControl" style="display:none;">
                                <table>
                                    <tr>
                                        <td>Mow Pattern Opacity:</td>
                                        <td><input id="mowPatternOpacitySlider" value="0" min="0" max="100" type="range"></td>
                                        <td><span id="mowPatternOpacityValue" style="margin-left:10px;"></span>%</td>
                                        <td><input class="button addMowPattern" type="button" value="New Pattern" onclick="document.getElementById('uploadedPattern').click();"></td>
                                    </tr>
                                </table>
                            </div>
                        </fieldset>
                        <br>
                    </div>
                </center>
            </div>
        </div>
        <div class="col span_1_of_4">
            <fieldset id="playerCoordinatesFieldset" style="display:none; max-height:600px; overflow:auto;">
                <legend>Player Coordinates & Ball Locations</legend>
                <select id="playerCoordSelect">
                    <option value="broadcastPlayers">Day / Night Player Coordinates</option>
                    <option value="webcastPlayers">Diagram Player Coordinates</option>
                    <option value="broadcastBall">Day / Night Ball Locations</option>
                    <option value="webcastBall">Diagram Ball Locations</option>
                </select>
                <div class="xy broadcastPlayers" style="display:none;"></div>
                <div class="xy broadcastBall" style="display:none;"></div>
                <div class="xy webcastPlayers" style="display:none;"></div>
                <div class="xy webcastBall" style="display:none;"></div>
                <div style="text-align:center; margin-top:5px;">
                    <input type="button" class="button" id="resetCoordinates" value="Reset Coordinates">
                </div>
            </fieldset>
            <fieldset class="weatherFieldset" style="display:block;">
                <legend>Weather Information</legend>
                    <table style="width:100%;">
                        <tr>
                            <td style="width:33%;">
                                &nbsp;
                            </td>
                            <td style="width:33%; text-align:center;">
                                Temperature
                            </td>
                            <td style="width:33%; text-align:center;">
                                Precipitation
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>January:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="JanTemp" id="JanTemp" type="number" value="57" style="width:99%;" data-month="January"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="JanRain" id="JanRain" type="number" value="2" style="width:99%;" data-month="January"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>February:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="FebTemp" id="FebTemp" type="number" value="58" style="width:99%;" data-month="February"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="FebRain" id="FebRain" type="number" value="3" style="width:99%;" data-month="February"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>March:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="MarTemp" id="MarTemp" type="number" value="58" style="width:99%;" data-month="March"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="MarRain" id="MarRain" type="number" value="3" style="width:99%;" data-month="March"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>April:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="AprTemp" id="AprTemp" type="number" value="61" style="width:99%;" data-month="April"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="AprRain" id="AprRain" type="number" value="1" style="width:99%;" data-month="April"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>May:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="MayTemp" id="MayTemp" type="number" value="63" style="width:99%;" data-month="May"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="MayRain" id="MayRain" type="number" value="0" style="width:99%;" data-month="May"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>June:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="JunTemp" id="JunTemp" type="number" value="66" style="width:99%;" data-month="June"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="JunRain" id="JunRain" type="number" value="0" style="width:99%;" data-month="June"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>July:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="JulTemp" id="JulTemp" type="number" value="69" style="width:99%;" data-month="July"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="JulRain" id="JulRain" type="number" value="0" style="width:99%;" data-month="July"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>August:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="AugTemp" id="AugTemp" type="number" value="71" style="width:99%;" data-month="August"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="AugRain" id="AugRain" type="number" value="0" style="width:99%;" data-month="August"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>September:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="SepTemp" id="SepTemp" type="number" value="70" style="width:99%;" data-month="September"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="SepRain" id="SepRain" type="number" value="1" style="width:99%;" data-month="September"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>October:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="OctTemp" id="OctTemp" type="number" value="67" style="width:99%;" data-month="October"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="OctRain" id="OctRain" type="number" value="1" style="width:99%;" data-month="October"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>November:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="NovTemp" id="NovTemp" type="number" value="62" style="width:99%;" data-month="November"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="NovRain" id="NovRain" type="number" value="1" style="width:99%;" data-month="November"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>December:</label>
                            </td>
                            <td style="width:33%;">
                                <input class="weather temperature" name="DecTemp" id="DecTemp" type="number" value="58" style="width:99%;" data-month="December"></input>
                            </td>
                            <td style="width:33%;">
                                <input class="weather rain" name="DecRain" id="DecRain" type="number" value="2" style="width:99%;" data-month="December"></input>
                            </td>
                        </tr>
                        <tr>
                            <td style="width:33%;">
                                <label>Average Wind:</label>
                            </td>
                            <td colspan="2" style="width:66%;">
                                <input name="avgWind" id="avgWind" type="number" value="8">
                            </td>
                        </td>
                    </td>
                </table>
            </fieldset>
            <br>
            <fieldset class="weatherFieldset">
                <legend>Calculated Weather Factors</legend>
                <table style="width:100%;">
                    <tr>
                        <td style="width:33%;">
                            <label>Ambient Temp:</label>
                        </td>
                        <td style="width:66%;">
                            <input name="Ambient" id="Ambient" type="number" value="0" step="0.1" readonly>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">
                            <label>Average Temp:</label>
                        </td>
                        <td style="width:66%;">
                            <input name="avgTemp" id="avgTemp" type="number" value="0" step="0.1" readonly>
                        </td>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">
                            <label>Average Rain:</label>
                        </td>
                        <td style="width:66%;">
                            <input name="avgRain" id="avgRain" type="number" value="0" step="0.1" readonly>
                        </td>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">
                            <label>Carry Left:</label>
                        </td>
                        <td style="width:66%;">
                            <input class="recalculate" name="carL" id="carL" type="number" value="0">
                        </td>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">
                            <label>Carry Center:</label>
                        </td>
                        <td style="width:66%;">
                            <input class="recalculate" name="carC" id="carC" type="number" value="0">
                        </td>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:33%;">
                            <label>Carry Right:</label>
                        </td>
                        <td style="width:66%;">
                            <input class="recalculate" name="carR" id="carR" type="number" value="0">
                        </td>
                        </td>
                    </tr>
                </table>
                </table>
            </fieldset>
            <br>
            <fieldset>
                <input class="button" type="button" id="about" value="About The OOTP Park Generator" style="margin-top:5px;">
                <input class="buttonLast" type="button" id="templateDownload" value="Download Mow Pattern Template">
                <div style="text-align:center; margin-top:5px;">
                    <a href="https://www.paypal.com/donate?business=UTTZRPAMBFCWA&no_recurring=1&currency_code=USD" target="_blank">
                        <img src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button">
                    </a>
                </div>
            </fieldset>
        </div>

        <div id="bgImageContainerDiv" style="top:0; left:0; width:100%; position:absolute; padding-top:100px; z-index:-11; display:none;">
            <center>
            <div id="tipContainerDiv" class="tipContainer800">
            <div id="bgImageDiv" class="broadcast">
                <div id="attribution" style="position:absolute; right:0; top:0; color:white; font-family: 'Archivo Narrow', sans-serif; font-weight:bold; text-align:right; padding-top:5px; padding-right:5px;"></div>
            </div>
            <div id="tipDiv" style="position:relative; height:100%; width:100%; padding-top:600px; padding-left:5px; text-align:left;">Use mouse to drag player/coordinate to desired position.</br>Use Arrow keys to move selected player/coordinate 1 pixel.<br>Use Shift+Arrow keys to move selected player/coordinate 10 pixels.</div>
            </div>
            </center>
        </div>
        <div style="top:0; left:0; width:100%; position:absolute; padding-top:100px; z-index:-100; display:none;">
            <center>
            <canvas id="fill" width="600" height="600"></canvas>
            </center>
        </div>
        <div style="top:0; left:0; width:100%; position:absolute; padding-top:100px; z-index:-10;">
            <center>
            <canvas id="c" width="600" height="600"></canvas>
            </center>
        </div>
        <div style="top:0; left:0; width:100%; position:absolute; padding-top:100px; z-index:-9;">
            <center>
            <canvas id="c2" width="600" height="600"></canvas>
            </center>
        </div>
        <div id="coordinateContainerDiv" class="coordinates noEvent">
            <center>
            <canvas id="coordinateCanvas" width="800" height="600"></canvas>
            </center>
        </div>
        <div class="bgdiv" style="top:0; left:0; width:100%; position:absolute; z-index:-20;">
        </div>
        <input type="hidden" value="" id="frmImageData" name="imagedata">
        <input type="hidden" value="" id="canvasData" name="canvas">
        <input type="hidden" value="" id="fillCanvasData" name="fillCanvas">
        <input type="hidden" value="" id="logoCanvasData" name="logoCanvas">
        <input type="hidden" value="" id="broadcastPlayerCoordinates" name="broadcastPlayerCoordinates">
        <input type="hidden" value="" id="webcastPlayerCoordinates" name="webcastPlayerCoordinates">
        <input type="hidden" value="" id="broadcastBallCoordinates" name="broadcastBallCoordinates">
        <input type="hidden" value="" id="webcastBallCoordinates" name="webcastBallCoordinates">
        <input type="hidden" value="" id="fieldOptionItems" name="fieldOptionItems">
    </form>
    <div id="FAQ" class="white-popup mfp-hide">
        <div style="width:100%; text-align:center;">    
            <span class="header" style="color:#BAD496!important;">About The OOTP Park Generator</span>
        </div>
        <div id="faqContainer" style="width:100%; height:90%; overflow:auto;">
            <div class="question" style="margin-top:10px!important;">So what is this thing?</div><br>
            <div class="answer">This is a utility designed to make it easy to create custom ballparks for Out Of The Park Baseball.  It is based on a spreadsheet developed by OOTP forum user Gambo, which you can download <a href="https://www.mediafire.com/file/z494wq8dlkkjuws/Gambo_Stadium_Chart_2013.rar/file" target="_blank">here</a>.</div><br>
            <div class="question">How does it work?</div><br>
            <div class="answer">At the minimum, just assign distances and heights to the outfield walls.  The Park Factors and overview image will calculate in real-time.  You can further customize your park by choosing its' location (and attendant weather) from a number of pre-defined cities in our database.</div><br>
            <div class="question">How does the park's location factor into things?</div><br>
            <div class="answer">The altitude and weather of the park's location directly affect the Park Factors.  A park located in Denver will play different than a park located at sea level.<br><br>Similarly, the climate of the park's location also plays a role.  The temperature and rain averages are used to calculate the park's "Carry Factor," which is used as a modifier when determining the Park Factors.<br><br>You are able to adjust the altitude and weather information to tailor the park to your liking.</div><br>
            <div class="question">How exactly are the Park Factors calculated?</div><br>
            <div class="answer">Through math!  Seriously, I did not develop the original formulas, I just transcoded them.  To see under the hood, you can take a look at the spreadsheet linked to above.</div><br>
            <div class="question">Why doesn't &#60;insert feature here&#62; work?</div><br>
            <div class="answer">This site has been written for use in either Mozilla Firefox or Google Chrome, and tested exclusively in Windows 7.  The core functionality - the calculation of Park Factors - should work in pretty much <i>any</i> browser and OS, although the underlying software that generates the park image may or may not work in any other browser.  The only other thing I can say is that Javascript needs to be enabled for everything to work properly.  Beyond that, the best I can suggest is try a different browser.</div><br>
            <div class="question">What is Out Of The Park Baseball?</div><br>
            <div class="answer">Out Of The Park Baseball is an award winning baseball management simulation published by OOTP Developments.  For more information about OOTP, as well as the other games they make, <a href="http://www.ootpdevelopments.com" target="_blank">visit their site</a>.</div><br>
            <div class="question">Who is responsible for this thing, and how can I get a hold of you?</div><br>
            <div class="answer">That would be me.  My name is Eriq Jaffe, and I've been playing OOTP Baseball since 2004.  Feel free to <a href="mailto:eriqjaffe@ootputilities.com">shoot me an email</a> with any questions or comments about this site.</div><br>
        </div>
    </div>
    <div id="wait" class="wait-popup mfp-hide wait">
        <div style="width:100%; text-align:center;">    
            <span class="header" style="color:black!important; font-size:2em!important;">Generating File, Hang On...</span>
        </div>
        <div class="spinning-ball"></div>
    </div>
    <div id="hiddenContainer" style="display:none;">
        <canvas id="final" width="600" height="600"></canvas>
    </div>
    </body>
    <script>
        var c = document.getElementById('c').getContext('2d');
        var canvas = new fabric.Canvas('c',{enableRetinaScaling:false});
        var c2 = document.getElementById('c2').getContext('2d');
        var logoCanvas = new fabric.Canvas('c2',{selection:false,enableRetinaScaling:false});
        var c3 = document.getElementById('coordinateCanvas').getContext('2d');
        var fillCanvas = new fabric.Canvas("fillCanvas",{enableRetinaScaling:false});
        var coordinateCanvas = new fabric.Canvas('coordinateCanvas',{selection:false,enableRetinaScaling:false});
        var current;
        var list = [];
        var state;
        var index = 0;
        var index2 = 0;
        var action = false;
        var refresh = true;
        var modifier = 1.0;
        var imgTop;
        var imgLeft;
        var clippingPath;

        var spinnerOptions = {lines: 13, length: 28, width: 14, radius: 42, scale: 3.25, corners: 1, color: '#648536', opacity: 0.25, rotate: 0, direction: 1, speed: 1, trail: 60, fps: 20, zIndex: 200, className: 'spinner', top: '50%', left: '50%', shadow: false, hwaccel: false, position: 'absolute'}
        var target = document.getElementById('spinner');
        var spinner = new Spinner(spinnerOptions).spin(target);
                
        var broadcastPlayers = '{ "objects": [';
        for (object in broadcastPlayerDefenseArray) {
            broadcastPlayers += '{"type":"group","originX":"left","originY":"top","left":'+broadcastPlayerDefenseArray[object]["y"]+',"top":'+broadcastPlayerDefenseArray[object]["x"]+',"width":209.25,"height":61,"fill":"rgb(0,0,0)","stroke":null,"strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"id":"'+object+'","hasControls":false,"borderColor":"yellow","xID":"'+broadcastPlayerDefenseArray[object]["short"]+'BroadcastCoordinateX","yID":"'+broadcastPlayerDefenseArray[object]["short"]+'BroadcastCoordinateY","objects":[{"type":"rect","originX":"left","originY":"top","left":-104.63,"top":-30.5,"width":166,"height":21.5,"fill":"#0000FD","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0},{"type":"rect","originX":"left","originY":"top","left":-104.63,"top":-9,"width":166,"height":21.5,"fill":"#FDFDFD","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0},{"type":"text","originX":"left","originY":"top","left":-98.63,"top":-28.5,"width":65.67,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":"'+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"\u0027Archivo Narrow\u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":""},{"type":"rect","originX":"left","originY":"top","left":62.38,"top":-30.5,"width":41.25,"height":60,"fill":"#BDBDBD","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0}]},'
        }
        for (object in broadcastPlayerOffenseArray) {
            broadcastPlayers += '{"type":"group","originX":"left","originY":"top","left":'+broadcastPlayerOffenseArray[object]["y"]+',"top":'+broadcastPlayerOffenseArray[object]["x"]+',"width":210,"height":61,"fill":"rgb(0,0,0)","stroke":null,"strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"id":"'+object+'","hasControls":false,"borderColor":"yellow","xID":"'+broadcastPlayerOffenseArray[object]["short"]+'BroadcastCoordinateX","yID":"'+broadcastPlayerOffenseArray[object]["short"]+'BroadcastCoordinateY","objects":[{"type":"rect","originX":"left","originY":"top","left":-62,"top":-13.5,"width":166,"height":21.5,"fill":"#FD0000","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0},{"type":"rect","originX":"left","originY":"top","left":-62,"top":7.5,"width":166,"height":21.5,"fill":"#FFFFFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0},{"type":"text","originX":"left","originY":"top","left":-58,"top":-11.5,"width":82.45,"height":20.97,"fill":"#000","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":"'+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"\u0027Archivo Narrow\u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":""},{"type":"rect","originX":"left","originY":"top","left":-105,"top":-30.5,"width":41.25,"height":60,"fill":"#BDBDBD","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0}]},'
        }
        broadcastPlayers = broadcastPlayers.substring(0, broadcastPlayers.length - 1);
        broadcastPlayers += '],"background":""}';
        var broadcastPlayersOriginal = broadcastPlayers;
        
        var webcastPlayers = '{ "objects": [';
        for (object in webcastPlayerArray) {
            webcastPlayers += '{"type":"group","originX":"left","originY":"top","left":'+webcastPlayerArray[object]["y"]+',"top":'+webcastPlayerArray[object]["x"]+',"width":122,"height":23.97,"fill":"rgb(0,0,0)","stroke":null,"strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"id":"'+object+'","hasControls":false,"borderColor":"yellow","xID":"'+webcastPlayerArray[object]["short"]+'WebcastCoordinateX","yID":"'+webcastPlayerArray[object]["short"]+'WebcastCoordinateY","objects":[{"type":"rect","originX":"left","originY":"top","left":-61,"top":-11.99,"width":121,"height":20,"fill":"rgba(0,0,0,0.5)","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"rx":0,"ry":0},{"type":"text","originX":"left","originY":"top","left":-55,"top":-9.99,"width":40.85,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":"'+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"\u0027Archivo Narrow\u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":""}]},'
        }
        webcastPlayers = webcastPlayers.substring(0, webcastPlayers.length - 1);
        webcastPlayers += '],"background":""}';
        var webcastPlayersOriginal = webcastPlayers;
        
        var broadcastBall;
        var webcastBall;
        var broadcastBallOriginal;
        var webcastBallOriginal;
        
        var html = "<table style=\"width:100%;\">\n"
                 + "<tr>\n"
                 + "<td style=\"width:33%;\">&nbsp;</td>\n"
                 + "<td style=\"width:33%; text-align:center;\">X</td>\n"
                 + "<td style=\"width:33%; text-align:center;\">Y</td>\n"
                 + "</tr>\n"
                 
        for (object in broadcastPlayerDefenseArray) {
            html += "<tr>\n"
                 + "<td style=\"width:33%;\">"+object+":</td>\n"
                 + "<td style=\"width:33%;\"><input class=\"xCoord 640 pCoordX\" name=\""+broadcastPlayerDefenseArray[object]["short"]+"BroadcastCoordinateX\" id=\""+broadcastPlayerDefenseArray[object]["short"]+"BroadcastCoordinateX\" type=\"number\" value=\""+Math.round((parseFloat(broadcastPlayerDefenseArray[object]["x"]/1.25)))+"\" min=\"0\" max=\"800\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\" data-id=\""+object+"\"></input></td>\n"
                 + "<td style=\"width:33%;\"><input class=\"yCoord 640 pCoordY\" name=\""+broadcastPlayerDefenseArray[object]["short"]+"BroadcastCoordinateY\" id=\""+broadcastPlayerDefenseArray[object]["short"]+"BroadcastCoordinateY\" type=\"number\" value=\""+Math.round((parseFloat(broadcastPlayerDefenseArray[object]["y"]/1.25)))+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\"></input></td>\n"
                 + "</tr>\n";
        }
        
        for (object in broadcastPlayerOffenseArray) {
            html += "<tr>\n"
            + "<td style=\"width:33%;\">"+object+":</td>\n"
            + "<td style=\"width:33%;\"><input class=\"xCoord 640 pCoordX\" name=\""+broadcastPlayerOffenseArray[object]["short"]+"BroadcastCoordinateX\" id=\""+broadcastPlayerOffenseArray[object]["short"]+"BroadcastCoordinateX\" type=\"number\" value=\""+Math.round((parseFloat(broadcastPlayerOffenseArray[object]["x"]/1.25)))+"\" min=\"0\" max=\"800\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\"></input></td>\n"
            + "<td style=\"width:33%;\"><input class=\"yCoord 640 pCoordY\" name=\""+broadcastPlayerOffenseArray[object]["short"]+"BroadcastCoordinateY\" id=\""+broadcastPlayerOffenseArray[object]["short"]+"BroadcastCoordinateY\" type=\"number\" value=\""+Math.round((parseFloat(broadcastPlayerOffenseArray[object]["y"]/1.25)))+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\"></input></td>\n"
            + "</tr>\n";
        }
        html += "</table>\n";
        $(".broadcastPlayers").html(html);
        
        html = "<table style=\"width:100%;\">\n"
        + "<tr>\n"
        + "<td style=\"width:33%;\">&nbsp;</td>\n"
        + "<td style=\"width:33%; text-align:center;\">X</td>\n"
        + "<td style=\"width:33%; text-align:center;\">Y</td>\n"
        + "</tr>\n"
        
        for (object in webcastPlayerArray) {
            html += "<tr>\n"
            + "<td style=\"width:33%;\">"+object+":</td>\n"
            + "<td style=\"width:33%;\"><input class=\"xCoord wCoordX\" name=\""+webcastPlayerArray[object]["short"]+"WebcastCoordinateX\" id=\""+webcastPlayerArray[object]["short"]+"WebcastCoordinateX\" type=\"number\" value=\""+webcastPlayerArray[object]["x"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\"></input></td>\n"
            + "<td style=\"width:33%;\"><input class=\"yCoord wCoordY\" name=\""+webcastPlayerArray[object]["short"]+"WebcastCoordinateY\" id=\""+webcastPlayerArray[object]["short"]+"WebcastCoordinateY\" type=\"number\" value=\""+webcastPlayerArray[object]["y"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"\"></input></td>\n"
            + "</tr>\n";
        }
        html += "</table>\n";
        $(".webcastPlayers").html(html);
        
        $(".colorSelector").spectrum({
            showInput: true,
            preferredFormat: "rgb",
            showInitial: true,
            showPalette: true,
            showButtons: true,
            showSelectionPalette: true,
            localStorageKey: "spectrum.parkgen",
            palette: [ ],
            color: "#FF0000"
        })
        
        $(document).ready(function() {
            if($.browser.msie) {
                if($.browser.version < 10) {
                    $("#downloadPark").css("display","none");
                    $("#factorFooter").css("display","none");
                    $("#svg").html("<br><br><br><br><br><br><br><br><span style=\"font-family: 'Crete Round', sans-serif; font-size:2em; color:white;\">Your version of Internet Explorer does not properly support the creation of ballpark ./images.<br><br>Please use Mozilla Firefox or Google Chrome instead.</span>");
                }
            }
            $('.upper-canvas').bind('contextmenu', function (e) {
                return false;
            });
            ipcRenderer.send('get-countries', null)
            $(".button").each(function(e) {
                $(this).prop("disabled",false);
            })   
            calculateWeather();
            generateField();
            calculateFactors();
            generateCoordinates();
        })

        ipcRenderer.on('get-countries-response', (event, data) => {
            $("#ballparkCountry").append($('<option>', {
                value: '',
                text: 'Select a country'
            }));
            JSON.parse(data).forEach(function (item, index) {
                $("#ballparkCountry").append($('<option>', {
                    value: item,
                    text: item
                }));
            });
        })

        $("#templateDownload").on("click",function(e) {
            e.preventDefault;
            ipcRenderer.send('get-template', null)
        })
        
        $(".recalculate, .number, .weather").keydown(function(event) {
            if (event.shiftKey == true) {
                event.preventDefault();
            }
            if ((event.keyCode >= 48 && event.keyCode <= 57) ||
                (event.keyCode >= 96 && event.keyCode <= 105) ||
                event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 37 ||
                event.keyCode == 39 || event.keyCode == 46) {

            } else {
                event.preventDefault();
            }
            if ($(this).val().indexOf('.') !== -1 && event.keyCode == 190)
                event.preventDefault();
        });
        
        $("#opacitySlider").on("input", function(e) {
            var activeObject = logoCanvas.getActiveObject();
            if (activeObject) {
                activeObject.set('opacity',parseInt($(this).val())/100);
                $("#opacityValue").html($(this).val());
                logoCanvas.renderAll();
            }
        })
        
        $("#mowPatternOpacitySlider").on("input", function(e) {
            mow_pattern.set('opacity',parseInt($(this).val())/100);
            $("#mowPatternOpacityValue").html($(this).val());
            canvas.renderAll();
        })
        
        $("#centerImage").on("click", function(e) {
            var activeObject = logoCanvas.getActiveObject();
            if (activeObject) {
                activeObject.set('left',300);
                activeObject.set('top',300);
                activeObject.set('angle',0);
                activeObject.setCoords();
                logoCanvas.renderAll();
            }
        })
        
        $("#duplicateImage").on("click", function(e) {
            var activeObject = logoCanvas.getActiveObject();
            if (activeObject) {
                activeObject.clone(function(c) {
                    c.set({
                        originX: 'center',
                        originY: 'center',
                        perPixelTargetFind: true,
                        centeredScaling: true,
                        centeredRotation: true,
                        borderColor: 'red',
                        cornerColor: 'yellow',
                        cornerSize: 12,
                        transparentCorners: false
                    });
                    c.resizeFilters.push(new fabric.Image.filters.Resize({
                        resizeType: 'lanczos', // typo fixed
                        lanczosLobes: 2 // typo fixed
                    }));
                    logoCanvas.add(c);
                })
            }
        })
        
        $(".rotate").on("click", function(e){
            var activeObject = logoCanvas.getActiveObject();
            if (activeObject) {
                if ($(this).attr("id") == "clockwise") {
                    newAngle = parseInt(activeObject.angle)+45;   
                } else {
                    newAngle = parseInt(activeObject.angle)-45;  
                }
                activeObject.setAngle(newAngle).setCoords();
                logoCanvas.renderAll();
            }
        })
        
        $("#removeWhite").on("click", function(e) {
            var filter = new fabric.Image.filters.RemoveWhite({
                threshold: 150,
                distance: 100,
            });
            var activeObject = logoCanvas.getActiveObject();
            if (activeObject) {
                activeObject.filters.push(filter);
                activeObject.applyFilters(logoCanvas.renderAll.bind(logoCanvas));
            }
        })
        
        $("body").keydown(function(event) {
            if (event.shiftKey) {
                var movementDelta = 10;
            } else {
                var movementDelta = 1;
            }
            if (logoCanvas.getActiveObject()) { 
                var activeObject = logoCanvas.getActiveObject()
                var canvas = logoCanvas;
            }
            if (coordinateCanvas.getActiveObject()) {
                var activeObject = coordinateCanvas.getActiveObject();
                var canvas = coordinateCanvas;
            }
            if (activeObject) {
                switch (event.keyCode) {
                    case 37:
                        event.preventDefault();
                        var a = activeObject.get('left') - movementDelta;
                        activeObject.set('left', a);
                        activeObject.setCoords();
                        canvas.renderAll();
                        break;
                    case 38:
                        event.preventDefault();
                        var a = activeObject.get('top') - movementDelta;
                        activeObject.set('top', a);
                        activeObject.setCoords();
                        canvas.renderAll();
                        break;
                    case 39:
                        event.preventDefault();
                        var a = activeObject.get('left') + movementDelta;
                        activeObject.set('left', a);
                        activeObject.setCoords();
                        canvas.renderAll();
                        break;
                    case 40:
                        event.preventDefault();
                        var a = activeObject.get('top') + movementDelta;
                        activeObject.set('top', a);
                        activeObject.setCoords();
                        canvas.renderAll();
                        break;
                    case 46: // delete
                    var obj = logoCanvas.getActiveObject();
                        if (obj.get('type') == "image") {
                            logoCanvas.remove(obj);
                            $("#opacityControl").css("display","none");
                            logoCanvas.renderAll();
                        }
                        break;
                }
                if (canvas == coordinateCanvas) {
                    var mod = 1;
                    if ($("#playerCoordSelect").val().indexOf("broadcast") > -1) {
                        mod = 1.25;
                    }
                    $("#"+activeObject.get("xID")).val(Math.round(parseFloat(activeObject.get('left'))/mod));
                    $("#"+activeObject.get("yID")).val(Math.round(parseFloat(activeObject.get('top'))/mod));
                }
            }
        })

        $(".recalculate").on("change", function(e) {
            calculateFactors();
        });

        $(".weather").on("change", function(e) {
            calculateWeather();
            calculateFactors();
        })

        $(".regenerate").on("change", function() {
            generateField();
            generateCoordinates();
        })

        $("#about").magnificPopup({
            items: {
                src: '#FAQ',
                type: 'inline'
            }
        });

        $("#reset").on("click", function() {
            location.href = location.href;
        })

        $("#ballparkSurface").on("change", function() {
            setSurface();
        })

        $('#ballparkCountry').change(function() {
            ipcRenderer.send('get-states',{country: $("#ballparkCountry").val()})
        })

        ipcRenderer.on('get-states-response', (event, data) => {
            if (data.count < 1) {
                $("#ballparkState").html("");
                $("#ballparkCity").html("");
                $("#ballparkState").prop("disabled", true);
                ipcRenderer.send('get-cities', {country: $("#ballparkCountry").val(), state: null})
            } else {
                $("#ballparkState").prop("disabled", false);
                $("#ballparkCity").prop("disabled", true);
                $("#ballparkCity").html("");
                $("#ballparkState").append($('<option>', {
                    value: "",
                    text: "Select a State/Province"
                }));
                JSON.parse(data.states).forEach(function (item, index) {;
                    $("#ballparkState").append($('<option>', {
                        value: item,
                        text: item
                    }));
                });
            }
        })

        $('#ballparkState').change(function() {
            $("#ballparkCity").html("");
            ipcRenderer.send('get-cities', {country: $("#ballparkCountry").val(), state: $("#ballparkState").val()})
        })

        ipcRenderer.on('get-cities-response', (event, data) => {
            $("#ballparkCity").prop("disabled", false);
            $("#ballparkCity").append($('<option>', {
                value: "",
                text: "Select a City"
            }));
            JSON.parse(data).forEach(function (item, index) {;
                $("#ballparkCity").append($('<option>', {
                    value: item,
                    text: item
                }));
            });
        })

        $('#ballparkCity').change(function() {;
            if ($("#ballparkState").val() == null) {
                state = "is null";
            } else {
                state = $("#ballparkState").val();
            }
            ipcRenderer.send('get-weather', {country: $("#ballparkCountry").val(), state: $("#ballparkState").val(), city: $("#ballparkCity").val() })
        })

        ipcRenderer.on('get-weather-response', (event, data) => {
            $("#ballparkAltitude").val(data[0].Altitude);
            $("#JanRain").val(data[0].JanRain);
            $("#FebRain").val(data[0].FebRain);
            $("#MarRain").val(data[0].MarRain);
            $("#AprRain").val(data[0].AprRain);
            $("#MayRain").val(data[0].MayRain);
            $("#JunRain").val(data[0].JunRain);
            $("#JulRain").val(data[0].JulRain);
            $("#AugRain").val(data[0].AugRain);
            $("#SepRain").val(data[0].SepRain);
            $("#OctRain").val(data[0].OctRain);
            $("#NovRain").val(data[0].NovRain);
            $("#DecRain").val(data[0].DecRain);
            $("#JanTemp").val(data[0].JanTemp);
            $("#FebTemp").val(data[0].FebTemp);
            $("#MarTemp").val(data[0].MarTemp);
            $("#AprTemp").val(data[0].AprTemp);
            $("#MayTemp").val(data[0].MayTemp);
            $("#JunTemp").val(data[0].JunTemp);
            $("#JulTemp").val(data[0].JulTemp);
            $("#AugTemp").val(data[0].AugTemp);
            $("#SepTemp").val(data[0].SepTemp);
            $("#OctTemp").val(data[0].OctTemp);
            $("#NovTemp").val(data[0].NovTemp);
            $("#DecTemp").val(data[0].DecTemp);
            $("#avgWind").val(data[0].AverageWind);
            calculateWeather();
        })

        $("#ballparkType").on("change", function() {
            if ($("#playerCoordSelect").val().indexOf("broadcast") > -1) {
                if ($("#ballparkType").val() == "3") {
                    $("#attribution").html("Image by Wikipedia user Dlz28")
                    $("#bgImageDiv").removeClass("webcast").removeClass("broadcast").addClass("broadcast_dome");
                } else {
                    $("#attribution").html("\"Rule of Thirds\" by Stuart Seeger, used under CC BY / Cropped from original");
                    $("#bgImageDiv").removeClass("webcast").removeClass("broadcast_dome").addClass("broadcast")
                }
            } else {
                $("#attribution").html("");
                $("#bgImageDiv").removeClass("broadcast").removeClass("broadcast_dome").addClass("webcast");
            }
            calculateWeather();
            calculateFactors();
        })

        $("#mow_pattern").on("change", function() {
            if ($(this).val() == "") {
                document.getElementById('uploadedPattern').click()
            } else {
                mowPattern($(this).val());
            }
            if ($(this).val().indexOf("data:image/png;base64") > -1) {
                $("#customMowPatternControl").css("display","inline-block");
            } else {
                $("#customMowPatternControl").css("display","none");
            }
        })

        $("#pitchingLane").on("change", function() {
            if ($(this).val() == "on") {
                pitching_lane.visible = true;
            } else {
                pitching_lane.visible = false;
            }
            canvas.renderAll();
        })

        $("#onDeckCircles").on("change", function() {
            if ($(this).val() == "on") {
                on_deck_L.visible = true;
                on_deck_R.visible = true;
            } else {
                on_deck_L.visible = false;
                on_deck_R.visible = false;
            }
            canvas.renderAll();
        })
        
        $("#distanceMarkers").on("change", function() {
            if ($(this).val() == "on") {
				wallPoints.bringToFront();
                wallPoints.visible = true;
            } else {
                wallPoints.visible = false;
            }
            logoCanvas.renderAll();
        })

        $("#infieldType").on("change", function() {
            if ($(this).val() == "full") {
                infield_turf.visible = false;
                sliding_pits.visible = false;
                infield_dirt.visible = true;
            } else {
                infield_turf.visible = true;
                sliding_pits.visible = true;
                infield_dirt.visible = false;
            }
            canvas.renderAll();
        })

        $("#randomName").on("click", function() {
            $.ajax({
                type: "POST",
                url: "randomname.php",
                success: function(data) {
                    $("#ballparkName").val(data);
                },
                error: function(data) {
                    alert(data);
                }
            });
        })

        $("#flipPark").on("click", function() {
            var distances = [];
            var heights = [];
            $(".height").each(function() {
                heights.push($(this).val());
            })
            $(".distance").each(function() {
                distances.push($(this).val());
            })
            $("#leftLine").val(distances[6]);
            $("#leftField").val(distances[5]);
            $("#leftCenter").val(distances[4]);
            $("#rightCenter").val(distances[2]);
            $("#rightField").val(distances[1]);
            $("#rightLine").val(distances[0]);
            $("#leftLineWall").val(heights[6]);
            $("#leftFieldWall").val(heights[5]);
            $("#leftCenterWall").val(heights[4]);
            $("#rightCenterWall").val(heights[2]);
            $("#rightFieldWall").val(heights[1]);
            $("#rightLineWall").val(heights[0]);
            generateField();
            generateCoordinates();
            calculateFactors();
        })

        $("#randomPark").on("click", function() {
            $(".randomizer").each(function() {
                var options = $(this).children('option');
                var random = Math.floor(options.length * (Math.random() % 1));
                if ($(this).attr("id") == "mow_pattern") {
                    while (random == 15) {
                        var random = Math.floor(options.length * (Math.random() % 1));
                    }
                }
                $(this).find('option')[random].selected = true;
            })
            $("#ballparkCapacity").val(Math.floor(Math.random() * (56000 - 1000 + 1) + 1000));
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 95) {
                var LL = Math.floor(Math.random() * (400 - 360) + 360);
            } else if (random > 90) {
                var LL = Math.floor(Math.random() * (300 - 230) + 230);
            } else {
                var LL = Math.floor(Math.random() * (370 - 290) + 290);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 95) {
                var LF = Math.floor(Math.random() * (415 - 385) + 385);
            } else {
                var LF = Math.floor(Math.random() * (385 - LL) + LL);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 90) {
                var LC = Math.floor(Math.random() * (460 - 420) + 420);
            } else {
                var LC = Math.floor(Math.random() * (410 - LF) + LF);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 95) {
                var RL = Math.floor(Math.random() * (400 - 360) + 360);
            } else if (random > 90) {
                var RL = Math.floor(Math.random() * (300 - 230) + 230);
            } else {
                var RL = Math.floor(Math.random() * (370 - 290) + 290);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 95) {
                var RF = Math.floor(Math.random() * (415 - 385) + 385);
            } else {
                var RF = Math.floor(Math.random() * (385 - RL) + RL);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 90) {
                var RC = Math.floor(Math.random() * (460 - 420) + 420);
            } else {
                var RC = Math.floor(Math.random() * (410 - RF) + RF);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 98) {
                var CF = Math.floor(Math.random() * (480 - 440) + 445);
            } else if (random > 94) {
                var CF = Math.floor(Math.random() * (455 - 420) + 430);
            } else if (random > 86) {
                var CF = Math.floor(Math.random() * (425 - 400) + 400);
            } else if (random > 43) {
                var CF = Math.floor(Math.random() * (410 - RC) + RC);
            } else {
                var CF = Math.floor(Math.random() * (410 - LC) + LC);
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 97) {
                var LLW = Math.floor(Math.random() * (60 - 35) + 35);
            } else if (random > 90) {
                var LLW = Math.floor(Math.random() * (35 - 20) + 20);
            } else if (random > 82) {
                var LLW = Math.floor(Math.random() * (20 - 8) + 8);
            } else if (random > 30) {
                var LLW = Math.floor(8 + Math.random() * (4 - 1) + 1);
            } else {
                var LLW = 8;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 97) {
                var RLW = Math.floor(Math.random() * (60 - 35) + 35);
            } else if (random > 90) {
                var RLW = Math.floor(Math.random() * (35 - 20) + 20);
            } else if (random > 82) {
                var RLW = Math.floor(Math.random() * (20 - 8) + 8);
            } else if (random > 30) {
                var RLW = Math.floor(8 + Math.random() * (4 - 1) + 1);
            } else {
                var RLW = 8;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 98) {
                var LFW = Math.floor(LLW + Math.random() * (20 - 1) + 1);
            } else if (random > 96) {
                var LFW = Math.floor(LLW - Math.random() * (20 - 1) + 1);
            } else {
                var LFW = LLW;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 98) {
                var RFW = Math.floor(RLW + Math.random() * (20 - 1) + 1);
            } else if (random > 96) {
                var RFW = Math.floor(RLW - Math.random() * (20 - 1) + 1);
            } else {
                var RFW = RLW;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 35) {
                var LCW = Math.floor(8 + Math.random() * (4 - 1) + 1);
            } else if (random > 30) {
                var LCW = Math.floor(LFW + Math.random() * (10 - 1) + 1);
            } else {
                var LCW = LFW;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 35) {
                var RCW = Math.floor(8 + Math.random() * (4 - 1) + 1);
            } else if (random > 30) {
                var RCW = Math.floor(LFW + Math.random() * (10 - 1) + 1);
            } else {
                var RCW = RFW;
            }
            var random = Math.floor(Math.random() * 100) + 1;
            if (random > 70) {
                var CFW = RCW;
            } else if (random > 40) {
                var CFW = LCW;
            } else if (random > 3) {
                var CFW = Math.floor((RCW + LCW) / 2);
            } else {
                var CFW = Math.floor(Math.random() * (60 - 8) + 8);
            }
            $("#leftLine").val(LL);
            $("#leftLineWall").val(LLW);
            $("#leftField").val(LF);
            $("#leftFieldWall").val(LFW);
            $("#leftCenter").val(LC);
            $("#leftCenterWall").val(LCW);
            $("#centerField").val(CF);
            $("#centerFieldWall").val(CFW);
            $("#rightLine").val(RL);
            $("#rightLineWall").val(RLW);
            $("#rightField").val(RF);
            $("#rightFieldWall").val(RFW);
            $("#rightCenter").val(RC);
            $("#rightCenterWall").val(RCW);
            generateField();
            generateCoordinates();
            $(".overlay").css("display","none");
            ipcRenderer.send('random-park', null)
        })

        ipcRenderer.on('random-park-response', (event, data) => {
            $("#ballparkName").val(data.parkName)
            $("#ballparkCountry").html("")
            $("#ballparkState").html("")
            $("#ballparkCity").html("")
            $("#ballparkCountry").append($('<option>', {
                value: '',
                text: 'Select a country'
            }));
            $("#ballparkState").append($('<option>', {
                value: '',
                text: 'Select a state'
            }));
            $("#ballparkCity").append($('<option>', {
                value: '',
                text: 'Select a city'
            }));
            $("#ballparkCountry").append($('<option>', {
                value: 'United States of America',
                text: 'United States of America'
            }));
            for (country of data.countries) {
                $("#ballparkCountry").append($('<option>', {
                    value: country,
                    text: country
                }))
            }
            for (state of data.states) {
                $("#ballparkState").append($('<option>', {
                    value: state,
                    text: state
                }))
            }
            for (city of data.cities) {
                $("#ballparkCity").append($('<option>', {
                    value: city,
                    text: city
                }))
            }
            $("#ballparkState").prop("disabled",false);
            $("#ballparkCity").prop("disabled",false);
            $("#ballparkCountry").val("United States of America")
            $("#ballparkState").val(data.city.State)
            $("#ballparkCity").val(data.city.City)
            $("#ballparkAltitude").val(data.city.Altitude);
            $("#JanRain").val(data.city.JanRain);
            $("#FebRain").val(data.city.FebRain);
            $("#MarRain").val(data.city.MarRain);
            $("#AprRain").val(data.city.AprRain);
            $("#MayRain").val(data.city.MayRain);
            $("#JunRain").val(data.city.JunRain);
            $("#JulRain").val(data.city.JulRain);
            $("#AugRain").val(data.city.AugRain);
            $("#SepRain").val(data.city.SepRain);
            $("#OctRain").val(data.city.OctRain);
            $("#NovRain").val(data.city.NovRain);
            $("#DecRain").val(data.city.DecRain);
            $("#JanTemp").val(data.city.JanTemp);
            $("#FebTemp").val(data.city.FebTemp);
            $("#MarTemp").val(data.city.MarTemp);
            $("#AprTemp").val(data.city.AprTemp);
            $("#MayTemp").val(data.city.MayTemp);
            $("#JunTemp").val(data.city.JunTemp);
            $("#JulTemp").val(data.city.JulTemp);
            $("#AugTemp").val(data.city.AugTemp);
            $("#SepTemp").val(data.city.SepTemp);
            $("#OctTemp").val(data.city.OctTemp);
            $("#NovTemp").val(data.city.NovTemp);
            $("#DecTemp").val(data.city.DecTemp);
            $("#avgWind").val(data.city.AverageWind);
            calculateWeather();
            calculateFactors();
        })

        function generateField() {
            canvas.clear();

            var LLx = Math.round(Math.cos(-135 * Math.PI / 180) * parseInt($("#leftLine").val()) + x0);
            var LLy = Math.round(Math.sin(-135 * Math.PI / 180) * parseInt($("#leftLine").val()) + y0);
            var LFx = Math.round(Math.cos(-120 * Math.PI / 180) * parseInt($("#leftField").val()) + x0);
            var LFy = Math.round(Math.sin(-120 * Math.PI / 180) * parseInt($("#leftField").val()) + y0);
            var LCx = Math.round(Math.cos(-105 * Math.PI / 180) * parseInt($("#leftCenter").val()) + x0);
            var LCy = Math.round(Math.sin(-105 * Math.PI / 180) * parseInt($("#leftCenter").val()) + y0);
            var CFx = Math.round(Math.cos(-90 * Math.PI / 180) * parseInt($("#centerField").val()) + x0);
            var CFy = Math.round(Math.sin(-90 * Math.PI / 180) * parseInt($("#centerField").val()) + y0);
            var RCx = Math.round(Math.cos(-75 * Math.PI / 180) * parseInt($("#rightCenter").val()) + x0);
            var RCy = Math.round(Math.sin(-75 * Math.PI / 180) * parseInt($("#rightCenter").val()) + y0);
            var RFx = Math.round(Math.cos(-60 * Math.PI / 180) * parseInt($("#rightField").val()) + x0);
            var RFy = Math.round(Math.sin(-60 * Math.PI / 180) * parseInt($("#rightField").val()) + y0);
            var RLx = Math.round(Math.cos(-45 * Math.PI / 180) * parseInt($("#rightLine").val()) + x0);
            var RLy = Math.round(Math.sin(-45 * Math.PI / 180) * parseInt($("#rightLine").val()) + y0);

            switch ($("#ballparkFoulArea").val()) {
                case "4":
                    var LF_foul_area = 155;
                    var RF_foul_area = 445;
                    var foul_area_y = 464;
                    var radii = "160";
                    var odcLx = 200;
                    var odcRx = 400;
                    break;
                case "3":
                    var LF_foul_area = 166;
                    var RF_foul_area = 434;
                    var foul_area_y = 475;
                    var radii = "160";
                    var odcLx = 215;
                    var odcRx = 385;
                    break;
                case "2":
                    var LF_foul_area = 187;
                    var RF_foul_area = 413;
                    var foul_area_y = 475;
                    var radii = "140";
                    var odcLx = 230;
                    var odcRx = 370;
                    break;
                case "0":
                    var LF_foul_area = 201;
                    var RF_foul_area = 399;
                    var foul_area_y = 475;
                    var radii = 115;
                    var odcLx = 240;
                    var odcRx = 360;
                    break;
                case "-3":
                    var LF_foul_area = 222;
                    var RF_foul_area = 378;
                    var foul_area_y = 489;
                    var radii = "90";
                    var odcLx = 250;
                    var odcRx = 350;
                    break;
                case "-4":
                    var LF_foul_area = 247;
                    var RF_foul_area = 353;
                    var foul_area_y = 500;
                    var radii = "65";
                    var odcLx = 260;
                    var odcRx = 340;
                    break;
                default:
                    var foul_area = "-50";
                    var foul_area_y = "25";
                    var radii = "65";
                    var odcLx = 260;
                    var odcRx = 340;
                    break;
            }
            
            foul_arc = radii + "," + radii + ",0,0,1," + LF_foul_area + "," + foul_area_y;

            wallPath = "M" + LF_foul_area + "," + foul_area_y + ",L" + (LLx - 3) + "," + (LLy + 24) + ",L" + LLx + "," + LLy + ",L" + LFx + "," + LFy + ",L" + LCx + "," + LCy + ",L" + CFx + "," + CFy + ",L" + RCx + "," + RCy + ",L" + RFx + "," + RFy + ",L" + RLx + "," + RLy + ",L" + (RLx + 3) + "," + (RLy + 24) + ",L" + RF_foul_area + "," + foul_area_y + ",A" + foul_arc + ",z";

            llText = new fabric.Text($("#leftLine").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: LLx - 5, 
                top: LLy - 5,
                fontSize: 20                
            });
            llTextStroke = new fabric.Text($("#leftLine").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: LLx - 5, 
                top: LLy - 5,
                fontSize: 20                
            });
            lfText = new fabric.Text($("#leftField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: LFx - 5, 
                top: LFy - 5,
                fontSize: 20                
            });
            lfTextStroke = new fabric.Text($("#leftField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                stroke: '#000000',
                strokeWidth: 2,
                left: LFx - 5, 
                top: LFy - 5,
                fontSize: 20                
            });
            lcText = new fabric.Text($("#leftCenter").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: LCx - 5, 
                top: LCy - 5,
                fontSize: 20                
            });
            lcTextStroke = new fabric.Text($("#leftCenter").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: LCx - 5, 
                top: LCy - 5,
                fontSize: 20                
            });
            cfText = new fabric.Text($("#centerField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: CFx, 
                top: CFy - 5,
                fontSize: 20                
            });
            cfTextStroke = new fabric.Text($("#centerField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: CFx, 
                top: CFy - 5,
                fontSize: 20                
            });
            rlText = new fabric.Text($("#rightLine").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RLx + 5, 
                top: RLy - 5,
                fontSize: 20                
            });
            rlTextStroke = new fabric.Text($("#rightLine").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RLx + 5, 
                top: RLy - 5,
                fontSize: 20                
            });
            rfText = new fabric.Text($("#rightField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RFx + 5, 
                top: RFy - 5,
                fontSize: 20                
            });
            rfTextStroke = new fabric.Text($("#rightField").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RFx + 5, 
                top: RFy - 5,
                fontSize: 20                
            });
            rcText = new fabric.Text($("#rightCenter").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "yellow",
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RCx + 5, 
                top: RCy - 5,
                fontSize: 20                
            });
            rcTextStroke = new fabric.Text($("#rightCenter").val(), {
                textAlign: 'center',
                originX: 'center',
                originY: 'center',
                fill: "#000000",
                stroke: '#000000',
                strokeWidth: 2,
                fontFamily: "'Archivo Narrow', sans-serif",
                fontWeight: "bold",
                left: RCx + 5, 
                top: RCy - 5,
                fontSize: 20                
            });
            wallPoints = new fabric.Group([llTextStroke,lfTextStroke,lcTextStroke,cfTextStroke,rlTextStroke,rfTextStroke,rcTextStroke,llText,lfText,lcText,cfText,rlText,rfText,rcText]);
            wallPoints.set({selectable:false,visible:false});
            outside_border = new fabric.Path(wallPath, {
                fill: 'transparent',
                originX: 'center',
                originY: 'center',
                stroke: '#FFFFFF',
                strokeWidth: 36,
                selectable: false
            });
            border = new fabric.Path(wallPath, {
                fill: 'transparent',
                originX: 'center',
                originY: 'center',
                stroke: '#E0C080',
                strokeWidth: 32,
                selectable: false
            });
            wall = new fabric.Path(wallPath, {
                fill: 'transparent',
                originX: 'center',
                originY: 'center',
                stroke: '#000000',
                strokeWidth: 4,
                selectable: false
            });
            field = new fabric.Path(wallPath, {
                fill: '#3B900F',
                originX: 'center',
                originY: 'center',
                selectable: false,
                id: 'field'
            });
            clippingPath = new fabric.Path(wallPath,{
                fill: 'transparent',
                originX: 'center',
                originY: 'center',
				id: 'clippingPath'
            });
            mow_pattern = new fabric.Path(wallPath, {
                fill: '#32850F',
                originX: 'center',
                originY: 'center',
                selectable: false
            });
            infield_grass = new fabric.Path("M300,474,L218,400,L300,320,L382,400,z", {
                fill: '#3B900F',
                selectable: false
            });
            home_circle = new fabric.Circle({
                radius: 24,
                fill: '#A7714F',
                left: 276,
                top: 450,
                selectable: false
            });
            infield_turf = new fabric.Path("M187.571,369.571,C211,253,388,253,412.429,369.571" + "M222.219,404.219,L300,326.438,L377.781,404.219", {
                fill: 'transparent',
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            sliding_pits = new fabric.Path("M211.613,400.684,L232.826,379.471,A25,25,0,0,1,232.826,421.896,z" + "M388.387,400.684,L367.175,379.471,A25,25,0,0,0,367.175,421.896,z" +
                "M300.000,316.367,L278.787,337.580,A25,25,0,0,0,322.213,337.580,z", {
                    fill: '#A7714F',
                    selectable: false
                });
            infield_dirt = new fabric.Path("M300,490.485,L185.45,375.935,C211,253,388,253,414.550,375.935,z" + "M300,472.101,L358.689,413.411,A25,25,0,0,1,358.689,385.127,L314.142,340.58,A20,20,0,0,1,285.858,340.58,L241.311,385.127,A25,25,0,0,1,241.311,413.411,z", {
                fill: '#A7714F',
                selectable: false
            });
            infield_dirt_full = new fabric.Path("M300,490.485,L185.45,375.935,C211,253,388,253,414.550,375.935,z", {
                fill: '#A7714F',
                selectable: false,
                visible: false
            });
            mound = new fabric.Circle({
                radius: 16,
                fill: '#A7714F',
                left: 284,
                top: 386,
                selectable: false
            });
            rubber = new fabric.Rect({
                left: 294,
                top: 400,
                width: 12,
                height: 4,
                fill: 'white',
                selectable: false
            });
            pitching_lane = new fabric.Rect({
                left: 295,
                top: 407,
                width: 10,
                height: 60,
                fill: '#A7714F'
            });
            first_base = new fabric.Rect({
                left: 370,
                top: 400,
                width: 8,
                height: 8,
                angle: 45,
                originX: 'center',
                originY: 'center',
                fill: 'white',
                selectable: false
            });
            second_base = new fabric.Rect({
                left: 300,
                top: 332,
                width: 8,
                height: 8,
                angle: 45,
                originX: 'center',
                originY: 'center',
                fill: 'white',
                selectable: false
            });
            third_base = new fabric.Rect({
                left: 230,
                top: 400,
                width: 8,
                height: 8,
                angle: 45,
                originX: 'center',
                originY: 'center',
                fill: 'white',
                selectable: false
            });
            home_plate = new fabric.Path("M300,482,L304.95,475.636,L304.95,469.979,L295.05,469.979,L295.05,475.636,z", {
                fill: "white",
                selectable: false
            });
            lf_line = new fabric.Path("M286,468,L" + LLx + "," + LLy, {
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            rf_line = new fabric.Path("M312,468,L" + RLx + "," + RLy, {
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            running_lane = new fabric.Path("M380,402,L383,405,L349,439,L345,435", {
                fill: 'transparent',
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            right_coach_box = new fabric.Path("M398,410,L392,404,L374,422,L380,428", {
                fill: 'transparent',
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            left_coach_box = new fabric.Path("M202,410,L208,404,L226,422,L220,428", {
                fill: 'transparent',
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            batters_boxes = new fabric.Path("M292,468,L286,468,L286,480,L292,480,L292,493,L306,493,L306,480,L312,480,L312,468,L306,468", {
                fill: 'transparent',
                stroke: 'white',
                strokeWidth: 2,
                selectable: false
            });
            on_deck_L = new fabric.Circle({
                radius: 8,
                fill: '#A7714F',
                stroke: 'white',
                originX: 'center',
                originY: 'center',
                top: 495,
                left: odcLx,
                selectable: false
            });
            on_deck_R = new fabric.Circle({
                radius: 8,
                fill: '#A7714F',
                stroke: 'white',
                originX: 'center',
                originY: 'center',
                top: 495,
                left: odcRx,
                selectable: false
            });

            infield_dirt_full.visible = false;
            infield_grass.visible = false;
            infield_turf.visible = false;
            sliding_pits.visible = false;

            canvas.add(outside_border);
            canvas.add(border);
            canvas.add(wall);
            canvas.add(field);
            canvas.add(mow_pattern);
            canvas.add(infield_turf);
            canvas.add(infield_grass);
            canvas.add(infield_dirt_full);
            canvas.add(infield_dirt);
            canvas.add(sliding_pits);
            canvas.add(home_circle);
            canvas.add(mound);
            canvas.add(pitching_lane);
            canvas.add(rubber);
            canvas.add(batters_boxes);
            canvas.add(on_deck_L);
            canvas.add(on_deck_R);
            canvas.add(lf_line);
            canvas.add(rf_line);
            canvas.add(running_lane);
            canvas.add(right_coach_box);
            canvas.add(left_coach_box);
            canvas.add(home_plate);
            canvas.add(first_base);
            canvas.add(second_base);
            canvas.add(third_base);
            logoCanvas.add(wallPoints);

            fieldSurface('./images/grass2.png');
            infieldGrassSurface('./images/grass2.png');
            dirtSurface('./images/SoilSand0218_9_S.jpg');
            mowPattern($("#mow_pattern").val());
            
            var imageObjects = logoCanvas.getObjects();
            logoCanvas.renderAll();
            setSurface();
        }

        function generateCoordinates() {
            var _2Fy = 516;
            
            var LLx = Math.round(Math.cos(-135 * Math.PI / 180) * parseInt($("#leftLine").val()) + x0);
            var LLy = Math.round(Math.sin(-135 * Math.PI / 180) * parseInt($("#leftLine").val()) + y0);
            var LFx = Math.round(Math.cos(-120 * Math.PI / 180) * parseInt($("#leftField").val()) + x0);
            var LFy = Math.round(Math.sin(-120 * Math.PI / 180) * parseInt($("#leftField").val()) + y0);
            var LCx = Math.round(Math.cos(-105 * Math.PI / 180) * parseInt($("#leftCenter").val()) + x0);
            var LCy = Math.round(Math.sin(-105 * Math.PI / 180) * parseInt($("#leftCenter").val()) + y0);
            var CFx = Math.round(Math.cos(-90 * Math.PI / 180) * parseInt($("#centerField").val()) + x0);
            var CFy = Math.round(Math.sin(-90 * Math.PI / 180) * parseInt($("#centerField").val()) + y0);
            var RCx = Math.round(Math.cos(-75 * Math.PI / 180) * parseInt($("#rightCenter").val()) + x0);
            var RCy = Math.round(Math.sin(-75 * Math.PI / 180) * parseInt($("#rightCenter").val()) + y0);
            var RFx = Math.round(Math.cos(-60 * Math.PI / 180) * parseInt($("#rightField").val()) + x0);
            var RFy = Math.round(Math.sin(-60 * Math.PI / 180) * parseInt($("#rightField").val()) + y0);
            var RLx = Math.round(Math.cos(-45 * Math.PI / 180) * parseInt($("#rightLine").val()) + x0);
            var RLy = Math.round(Math.sin(-45 * Math.PI / 180) * parseInt($("#rightLine").val()) + y0);
            
            var lfFoulX = LLx-3;
            var lfFoulY = LLy+24;
            var rfFoulX = RLx+3;
            var rfFoulY = RLy+24;

            var _7LSx = Math.round(Math.cos(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.2)+170) + x0);
            var _7LSy = Math.round(Math.sin(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.2)+170) + y0);
            var _7LMx = Math.round(Math.cos(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.5)+170) + x0);
            var _7LMy = Math.round(Math.sin(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.5)+170) + y0);
            var _7LDx = Math.round(Math.cos(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.8)+170) + x0);
            var _7LDy = Math.round(Math.sin(-133 * Math.PI / 180) * (((parseInt($("#leftLine").val()) - 170)*.8)+170) + y0);

            var _7Sx = Math.round(Math.cos(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.2)+200) + x0);
            var _7Sy = Math.round(Math.sin(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.2)+200) + y0);
            var _7Mx = Math.round(Math.cos(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.5)+200) + x0);
            var _7My = Math.round(Math.sin(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.5)+200) + y0);
            var _7Dx = Math.round(Math.cos(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.8)+200) + x0);
            var _7Dy = Math.round(Math.sin(-120 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 200)*.8)+200) + y0);

            var _78Sx = Math.round(Math.cos(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.2)+210) + x0);
            var _78Sy = Math.round(Math.sin(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.2)+210) + y0);
            var _78Mx = Math.round(Math.cos(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.5)+210) + x0);
            var _78My = Math.round(Math.sin(-105 * Math.PI / 180) * (((parseInt($("#leftField").val()) - 210)*.5)+210) + y0);
            var _78Dx = Math.round(Math.cos(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.7)+210) + x0);
            var _78Dy = Math.round(Math.sin(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.7)+210) + y0);
            var _78XDx = Math.round(Math.cos(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.9)+210) + x0);
            var _78XDy = Math.round(Math.sin(-105 * Math.PI / 180) * (((parseInt($("#leftCenter").val()) - 210)*.9)+210) + y0);

            var _8LSx = Math.round(Math.cos(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.2)+210) + x0);
            var _8LSy = Math.round(Math.sin(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.2)+210) + y0);
            var _8LMx = Math.round(Math.cos(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.5)+210) + x0);
            var _8LMy = Math.round(Math.sin(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.5)+210) + y0);
            var _8LDx = Math.round(Math.cos(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.7)+210) + x0);
            var _8LDy = Math.round(Math.sin(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.7)+210) + y0);
            var _8LXDx = Math.round(Math.cos(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.9)+210) + x0);
            var _8LXDy = Math.round(Math.sin(-95 * Math.PI / 180) * ((((((parseInt($("#leftCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.9)+210) + y0);

            var _8RSx = Math.round(Math.cos(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.2)+210) + x0);
            var _8RSy = Math.round(Math.sin(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.2)+210) + y0);
            var _8RMx = Math.round(Math.cos(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.5)+210) + x0);
            var _8RMy = Math.round(Math.sin(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.5)+210) + y0);
            var _8RDx = Math.round(Math.cos(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.7)+210) + x0);
            var _8RDy = Math.round(Math.sin(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.7)+210) + y0);
            var _8RXDx = Math.round(Math.cos(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.9)+210) + x0);
            var _8RXDy = Math.round(Math.sin(-85 * Math.PI / 180) * ((((((parseInt($("#rightCenter").val())*0.48+(parseInt($("#centerField").val())*1.52))/2)) - 210)*.9)+210) + y0);

            var _89Sx = Math.round(Math.cos(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.2)+210) + x0);
            var _89Sy = Math.round(Math.sin(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.2)+210) + y0);
            var _89Mx = Math.round(Math.cos(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.5)+210) + x0);
            var _89My = Math.round(Math.sin(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.5)+210) + y0);
            var _89Dx = Math.round(Math.cos(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.7)+210) + x0);
            var _89Dy = Math.round(Math.sin(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.7)+210) + y0);
            var _89XDx = Math.round(Math.cos(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.9)+210) + x0);
            var _89XDy = Math.round(Math.sin(-75 * Math.PI / 180) * (((parseInt($("#rightCenter").val()) - 210)*.9)+210) + y0);

            var _9Sx = Math.round(Math.cos(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.2)+200) + x0);
            var _9Sy = Math.round(Math.sin(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.2)+200) + y0);
            var _9Mx = Math.round(Math.cos(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.5)+200) + x0);
            var _9My = Math.round(Math.sin(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.5)+200) + y0);
            var _9Dx = Math.round(Math.cos(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.8)+200) + x0);
            var _9Dy = Math.round(Math.sin(-60 * Math.PI / 180) * (((parseInt($("#rightField").val()) - 200)*.8)+200) + y0);

            var _9LSx = Math.round(Math.cos(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.2)+170) + x0);
            var _9LSy = Math.round(Math.sin(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.2)+170) + y0);
            var _9LMx = Math.round(Math.cos(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.5)+170) + x0);
            var _9LMy = Math.round(Math.sin(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.5)+170) + y0);
            var _9LDx = Math.round(Math.cos(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.8)+170) + x0);
            var _9LDy = Math.round(Math.sin(-47 * Math.PI / 180) * (((parseInt($("#rightLine").val()) - 170)*.8)+170) + y0);

            var wallPointsArray = {"xWLL":{"x":LLx,"y":LLy},"xWL":{"x":LFx,"y":LFy},"xWLC":{"x":LCx,"y":LCy},"xWC":{"x":CFx,"y":CFy},"xWRC":{"x":RCx,"y":RCy},"xWR":{"x":RFx,"y":RFy},"xWRL":{"x":RLx,"y":RLy},"x7LS":{"x":_7LSx,"y":_7LSy},"x7LM":{"x":_7LMx,"y":_7LMy},"x7LD":{"x":_7LDx,"y":_7LDy},"x7S":{"x":_7Sx,"y":_7Sy},"x7M":{"x":_7Mx,"y":_7My},"x7D":{"x":_7Dx,"y":_7Dy},"x78S":{"x":_78Sx,"y":_78Sy},"x78M":{"x":_78Mx,"y":_78My},"x78D":{"x":_78Dx,"y":_78Dy},"x78XD":{"x":_78XDx,"y":_78XDy},"x8LS":{"x":_8LSx,"y":_8LSy},"x8LM":{"x":_8LMx,"y":_8LMy},"x8LD":{"x":_8LDx,"y":_8LDy},"x8LXD":{"x":_8LXDx,"y":_8LXDy},"x8RS":{"x":_8RSx,"y":_8RSy},"x8RM":{"x":_8RMx,"y":_8RMy},"x8RD":{"x":_8RDx,"y":_8RDy},"x8RXD":{"x":_8RXDx,"y":_8RXDy},"x9LS":{"x":_9LSx,"y":_9LSy},"x9LM":{"x":_9LMx,"y":_9LMy},"x9LD":{"x":_9LDx,"y":_9LDy},"x9S":{"x":_9Sx,"y":_9Sy},"x9M":{"x":_9Mx,"y":_9My},"x9D":{"x":_9Dx,"y":_9Dy},"x89S":{"x":_89Sx,"y":_89Sy},"x89M":{"x":_89Mx,"y":_89My},"x89D":{"x":_89Dx,"y":_89Dy},"x89XD":{"x":_89XDx,"y":_89XDy}}
        
            switch ($("#ballparkFoulArea").val()) {
                case "-4":
                    // extra small
                    _2Fy = 528;
                    break;
                case "-3":
                    // small
                    _2Fy = 536;
                    break;
                case "0":
                    // average
                    _2Fy = 532;
                    break;
                case "2":
                    // large
                    _2Fy = 534;
                    break;
                case "3":
                    // very  large
                    _2Fy = 547;
                    break;  
                case "4":
                    // extra large
                    _2Fy = 542;
                    break;
                default:
                    _2Fy = 532;
            }

            var LFFoulLineDist = Math.sqrt( (300-lfFoulX)*(300-lfFoulX) + (_2Fy-lfFoulY)*(_2Fy-lfFoulY) );
            var RFFoulLineDist = Math.sqrt( (300-rfFoulX)*(300-rfFoulX) + (_2Fy-rfFoulY)*(_2Fy-rfFoulY) );
            
            var _7LDFx = Math.round(Math.cos(-131 * Math.PI / 180) * (((LFFoulLineDist - 170)*.9)+170) + x0);
            var _7LDFy = Math.round(Math.sin(-131 * Math.PI / 180) * (((LFFoulLineDist - 170)*.9)+170) + _2Fy);
            var _9LDFx = Math.round(Math.cos(-49 * Math.PI / 180) * (((RFFoulLineDist - 170)*.9)+170) + x0);
            var _9LDFy = Math.round(Math.sin(-49 * Math.PI / 180) * (((RFFoulLineDist - 170)*.9)+170) + _2Fy);
            
            var _7LMFx = Math.round(Math.cos(-133 * Math.PI / 180) * (((LFFoulLineDist - 170)*.6)+170) + x0);
            var _7LMFy = Math.round(Math.sin(-133 * Math.PI / 180) * (((LFFoulLineDist - 170)*.6)+170) + _2Fy);
            var _9LMFx = Math.round(Math.cos(-47 * Math.PI / 180) * (((RFFoulLineDist - 170)*.6)+170) + x0);
            var _9LMFy = Math.round(Math.sin(-47 * Math.PI / 180) * (((RFFoulLineDist - 170)*.6)+170) + _2Fy);
            
            var _7LSFx = Math.round(Math.cos(-134 * Math.PI / 180) * (((LFFoulLineDist - 170)*.2)+170) + x0);
            var _7LSFy = Math.round(Math.sin(-134 * Math.PI / 180) * (((LFFoulLineDist - 170)*.2)+170) + _2Fy);
            var _9LSFx = Math.round(Math.cos(-46 * Math.PI / 180) * (((RFFoulLineDist - 170)*.2)+170) + x0);
            var _9LSFy = Math.round(Math.sin(-46 * Math.PI / 180) * (((RFFoulLineDist - 170)*.2)+170) + _2Fy);
            
            var _5DFx = Math.round(Math.cos(-135 * Math.PI / 180) * (170) + x0);
            var _5DFy = Math.round(Math.sin(-135 * Math.PI / 180) * (170) + _2Fy);
            var _3DFx = Math.round(Math.cos(-45 * Math.PI / 180) * (170) + x0);
            var _3DFy = Math.round(Math.sin(-45 * Math.PI / 180) * (170) + _2Fy);
            
            var _5Fx = Math.round(Math.cos(-136 * Math.PI / 180) * (140) + x0);
            var _5Fy = Math.round(Math.sin(-136 * Math.PI / 180) * (140) + _2Fy);
            var _3Fx = Math.round(Math.cos(-44 * Math.PI / 180) * (140) + x0);
            var _3Fy = Math.round(Math.sin(-44 * Math.PI / 180) * (140) + _2Fy);
            
            var _5SFx = Math.round(Math.cos(-137 * Math.PI / 180) * (110) + x0);
            var _5SFy = Math.round(Math.sin(-137 * Math.PI / 180) * (110) + _2Fy);
            var _3SFx = Math.round(Math.cos(-43 * Math.PI / 180) * (110) + x0);
            var _3SFy = Math.round(Math.sin(-43 * Math.PI / 180) * (110) + _2Fy);
            
            var _25Fx = Math.round(Math.cos(-138 * Math.PI / 180) * (75) + x0);
            var _25Fy = Math.round(Math.sin(-138 * Math.PI / 180) * (75) + _2Fy);
            var _23Fx = Math.round(Math.cos(-42 * Math.PI / 180) * (75) + x0);
            var _23Fy = Math.round(Math.sin(-42 * Math.PI / 180) * (75) + _2Fy);
            
            var _2LFx = Math.round(Math.cos(-143 * Math.PI / 180) * (45) + x0);
            var _2LFy = Math.round(Math.sin(-143 * Math.PI / 180) * (45) + _2Fy);
            var _2RFx = Math.round(Math.cos(-37 * Math.PI / 180) * (45) + x0);
            var _2RFy = Math.round(Math.sin(-37 * Math.PI / 180) * (45) + _2Fy);
            
            var foulPointsArray = {"x2F":{"x":300,"y":_2Fy},"x2LF":{"x":_2LFx,"y":_2LFy},"x2RF":{"x":_2RFx,"y":_2RFy},"x5DF":{"x":_5DFx,"y":_5DFy},"x3DF":{"x":_3DFx,"y":_3DFy},"x5F":{"x":_5Fx,"y":_5Fy},"x3F":{"x":_3Fx,"y":_3Fy},"x5SF":{"x":_5SFx,"y":_5SFy},"x3SF":{"x":_3SFx,"y":_3SFy},"x25F":{"x":_25Fx,"y":_25Fy},"x23F":{"x":_23Fx,"y":_23Fy},"x7LDF":{"x":_7LDFx,"y":_7LDFy},"x7LMF":{"x":_7LMFx,"y":_7LMFy},"x7LSF":{"x":_7LSFx,"y":_7LSFy},"x9LDF":{"x":_9LDFx,"y":_9LDFy},"x9LMF":{"x":_9LMFx,"y":_9LMFy},"x9LSF":{"x":_9LSFx,"y":_9LSFy}};
            
            broadcastBall = '{"objects":[';
            for (object in wallPointsArray) {
                broadcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+(wallPointsArray[object]["x"]+100)+',"top":'+wallPointsArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Broadcast","xID":"'+object+'BroadcastCoordinateX","yID":"'+object+'BroadcastCoordinateY"},'
            }
            for (object in staticBallLocationArray) {
                broadcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+(staticBallLocationArray[object]["x"]+100)+',"top":'+staticBallLocationArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Broadcast","xID":"'+object+'BroadcastCoordinateX","yID":"'+object+'BroadcastCoordinateY"},'
            }
            for (object in foulPointsArray) {
                broadcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+(foulPointsArray[object]["x"]+100)+',"top":'+foulPointsArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Broadcast","xID":"'+object+'BroadcastCoordinateX","yID":"'+object+'BroadcastCoordinateY"},'
            }   
            broadcastBall = broadcastBall.substring(0, broadcastBall.length - 1);
            broadcastBall +='],"background":""}';
            
            broadcastBallOriginal = broadcastBall;
            
            var html = "<table style=\"width:100%;\">\n"
                     + "<tr>\n"
                     + "<td style=\"width:10%;\">&nbsp;</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">X</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">Y</td>\n"
                     + "<td style=\"width:10%;\">&nbsp;</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">X</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">Y</td>\n"
                     + "</tr>\n"
                     + "<tr>";
            
            var x = 1;
            for (object in wallPointsArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                     + "<td><input class=\"xCoord 640 bbCoordX\" name=\""+object+"BroadcastCoordinateX\" id=\""+object+"BroadcastCoordinateX\" type=\"number\" value=\""+Math.round((parseFloat(wallPointsArray[object]["x"]/1.25)))+"\" min=\"0\" max=\"800\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n"
                     + "<td><input class=\"yCoord 640 bbCoordY\" name=\""+object+"BroadcastCoordinateY\" id=\""+object+"BroadcastCoordinateY\" type=\"number\" value=\""+Math.round((parseFloat(wallPointsArray[object]["y"]/1.25)))+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                         + "<tr>\n";
                }
                x++;
            }
            for (object in staticBallLocationArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                + "<td><input class=\"xCoord 640 bbCoordX\" name=\""+object+"BroadcastCoordinateX\" id=\""+object+"BroadcastCoordinateX\" type=\"number\" value=\""+Math.round((parseFloat(staticBallLocationArray[object]["x"]/1.25)))+"\" min=\"0\" max=\"800\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n"
                + "<td><input class=\"yCoord 640 bbCoordY\" name=\""+object+"BroadcastCoordinateY\" id=\""+object+"BroadcastCoordinateY\" type=\"number\" value=\""+Math.round((parseFloat(staticBallLocationArray[object]["y"]/1.25)))+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                    + "<tr>\n";
                }
                x++;
            }
            for (object in foulPointsArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                + "<td><input class=\"xCoord 640 bbCoordX\" name=\""+object+"BroadcastCoordinateX\" id=\""+object+"BroadcastCoordinateX\" type=\"number\" value=\""+Math.round((parseFloat(foulPointsArray[object]["x"]/1.25)))+"\" min=\"0\" max=\"800\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n"
                + "<td><input class=\"yCoord 640 bbCoordY\" name=\""+object+"BroadcastCoordinateY\" id=\""+object+"BroadcastCoordinateY\" type=\"number\" value=\""+Math.round((parseFloat(foulPointsArray[object]["y"]/1.25)))+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Broadcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                    + "<tr>\n";
                }
                x++;
            }
            html += "</table>\n";
            $(".broadcastBall").html(html);
            
            webcastBall = '{"objects":[';
            for (object in wallPointsArray) {
                webcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+wallPointsArray[object]["x"]+',"top":'+wallPointsArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Webcast","xID":"'+object+'WebcastCoordinateX","yID":"'+object+'WebcastCoordinateY"},'
            }
            for (object in staticBallLocationArray) {
                webcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+staticBallLocationArray[object]["x"]+',"top":'+staticBallLocationArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Webcast","xID":"'+object+'WebcastCoordinateX","yID":"'+object+'WebcastCoordinateY"},'
            }
            for (object in foulPointsArray) {
                webcastBall += '{"type":"text","originX":"left","originY":"bottom","left":'+foulPointsArray[object]["x"]+',"top":'+foulPointsArray[object]["y"]+',"width":32.8,"height":20.97,"fill":"#FFF","stroke":null,"strokeWidth":1,"strokeDashArray":null,"strokeLineCap":"butt","strokeLineJoin":"miter","strokeMiterLimit":10,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"clipTo":null,"backgroundColor":"","fillRule":"nonzero","globalCompositeOperation":"source-over","transformMatrix":null,"hasControls":false,"text":" '+object+'","fontSize":16,"fontWeight":"normal","fontFamily":"/u0027Archivo Narrow/u0027,sans-serif","fontStyle":"","lineHeight":1.16,"textDecoration":"","textAlign":"left","textBackgroundColor":"rgba(0, 0, 0, 0.75)","borderColor":"yellow","id":"'+object+'Webcast","xID":"'+object+'WebcastCoordinateX","yID":"'+object+'WebcastCoordinateY"},'
            }
            webcastBall = webcastBall.substring(0, webcastBall.length - 1);
            webcastBall +='],"background":""}';
            webcastBallOriginal = webcastBall;

            html = "<table style=\"width:100%;\">\n"
                     + "<tr>\n"
                     + "<td style=\"width:10%;\">&nbsp;</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">X</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">Y</td>\n"
                     + "<td style=\"width:10%;\">&nbsp;</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">X</td>\n"
                     + "<td style=\"text-align:center; width:20%;\">Y</td>\n"
                     + "</tr>\n"
                     + "<tr>";
            
            var x = 1;
            for (object in wallPointsArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                     + "<td><input class=\"xCoord wbCoordX\" name=\""+object+"WebcastCoordinateX\" id=\""+object+"WebcastCoordinateX\" type=\"number\" value=\""+wallPointsArray[object]["x"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n"
                     + "<td><input class=\"yCoord wbCoordY\" name=\""+object+"WebcastCoordinateY\" id=\""+object+"WebcastCoordinateY\" type=\"number\" value=\""+wallPointsArray[object]["y"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                         + "<tr>\n";
                }
                x++;
            }
            for (object in staticBallLocationArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                + "<td><input class=\"xCoord wbCoordX\" name=\""+object+"WebcastCoordinateX\" id=\""+object+"WebcastCoordinateX\" type=\"number\" value=\""+staticBallLocationArray[object]["x"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n"
                + "<td><input class=\"yCoord wbCoordY\" name=\""+object+"WebcastCoordinateY\" id=\""+object+"WebcastCoordinateY\" type=\"number\" value=\""+staticBallLocationArray[object]["y"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                    + "<tr>\n";
                }
                x++;
            }
            for (object in foulPointsArray) {
                html += "<td style=\"text-align:right;\">"+object+":</td>\n"
                + "<td><input class=\"xCoord wbCoordX\" name=\""+object+"WebcastCoordinateX\" id=\""+object+"WebcastCoordinateX\" type=\"number\" value=\""+foulPointsArray[object]["x"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n"
                + "<td><input class=\"yCoord wbCoordY\" name=\""+object+"WebcastCoordinateY\" id=\""+object+"WebcastCoordinateY\" type=\"number\" value=\""+foulPointsArray[object]["y"]+"\" min=\"0\" max=\"600\" step=\"1\" style=\"width:99%;\" data-id=\""+object+"Webcast\" data-text=\""+object+"\"></input></td>\n";
                if (isOdd(x)) {
                    html += "</tr>\n"
                    + "<tr>\n";
                }
                x++;
            }
            html += "</table>\n";

            $(".webcastBall").html(html);
            
            coordinateCanvas.renderAll();
            populateCanvas3($("#playerCoordSelect").val());
        }
        
        function fieldSurface(url) {
            fabric.util.loadImage(url, function(img) {
                field.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                setTimeout(function(){
                    canvas.renderAll();
                }, 1000);
            }); 
        }

        function infieldGrassSurface(url) {
            fabric.util.loadImage(url, function(img) {
                infield_grass.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                setTimeout(function(){
                    canvas.renderAll();
                }, 1000);
            });
        }

        function dirtSurface(url) {
            fabric.util.loadImage(url, function(img) {
                infield_dirt.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                infield_dirt_full.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                home_circle.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                mound.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                sliding_pits.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "repeat"
                });
                if ($("#ballparkSurface").val() == "LAWN" || $("#ballparkSurface").val() == "FIELD") {
                    on_deck_L.fill = 'transparent';
                    on_deck_R.fill = 'transparent';
                } else {
                    on_deck_L.fill = new fabric.Pattern({
                        source: img,
                        offsetX: field.getBoundingRect().left * -1,
                        offsetY: field.getBoundingRect().top * -1,
                        repeat: "repeat"
                    });
                    on_deck_R.fill = new fabric.Pattern({
                        source: img,
                        offsetX: field.getBoundingRect().left * -1,
                        offsetY: field.getBoundingRect().top * -1,
                        repeat: "repeat"
                    });
                }
                setTimeout(function(){
                    canvas.renderAll();
                }, 1000);
            });
        }

        function setSurface() {
            if ($("#onDeckCircles").val() == "on") {
                on_deck_L.visible = true;
                on_deck_R.visible = true;
            } else {
                on_deck_L.visible = false;
                on_deck_R.visible = false;
            }

            if ($("#pitchingLane").val() == "on") {
                pitching_lane.visible = true;
            } else {
                pitching_lane.visible = false;
            }

            if ($("#distanceMarkers").val() == "on") {
                wallPoints.visible = true;
            } else {
                wallPoints.visible = false;
            }
            
            switch ($("#ballparkSurface").val()) {
                case "AT":
                    fieldSurface('./images/ATurf0020_2_S.jpg');
                    infield_grass.visible = false;
                    mow_pattern.visible = false;
                    infield_dirt.visible = false;
                    infield_turf.visible = true;
                    sliding_pits.visible = true;
                    $("#infieldTypeItem").css("display", "inline-block");
                    $("#pitchingLaneItem").css("display", "inline-block");
                    break;
                case "ATDI":
                    fieldSurface('./images/ATurf0020_2_S.jpg');
                    mow_pattern.visible = false;
                    infield_dirt.visible = false;
                    infield_dirt_full.visible = true;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "none");
                    break;
                case "ATGO":
                    fieldSurface('./images/grass2.png');
                    infieldGrassSurface('./images/ATurf0020_2_S.jpg');
                    infield_grass.visible = true;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "inline-block");
                    break;
                case "DIRT":
                    fieldSurface('./images/SoilSand0218_9_S.jpg');
                    mow_pattern.visible = false;
                    infield_dirt.visible = false;
                    infield_dirt_full.visible = false;
                    mound.visible = false;
                    home_circle.visible = false;
                    pitching_lane.visible = false;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "none");
                    break;
                case "DGA":
                    infield_dirt.visible = false;
                    infield_dirt_full.visible = true;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "none");
                    break;
                case "FIELD":
                    fieldSurface('./images/Grass0053_24_S.jpg');
                    mow_pattern.visible = false;
                    infield_dirt.visible = false;
                    infield_dirt_full.visible = false;
                    mound.visible = false;
                    home_circle.visible = false;
                    pitching_lane.visible = false;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "none");
                    break;
                case "FT":
                    fieldSurface('./images/FTurf0020_2_S.jpg');
                    infield_grass.visible = false;
                    mow_pattern.visible = false;
                    $("#infieldTypeItem").css("display", "inline-block");
                    $("#pitchingLaneItem").css("display", "inline-block");
                    break;
                case "LAWN":
                    fieldSurface('./images/Grass0053_26_S.jpg');
                    mow_pattern.visible = false;
                    infield_dirt.visible = false;
                    infield_dirt_full.visible = false;
                    mound.visible = false;
                    home_circle.visible = false;
                    pitching_lane.visible = false;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "none");
                    break;
                default:
                    fieldSurface('./images/grass2.png');
                    infield_grass.visible = false;
                    $("#infieldTypeItem").css("display", "none");
                    $("#pitchingLaneItem").css("display", "inline-block");
                    break;
            }
            if (sliding_pits.visible == true) {
                $("#infieldType").val("pits")
            } else {
                $("#infieldType").val("full")
            }
            if (mow_pattern.visible == true) {
                $("#mowPatternItem").css("display", "inline-block");
            } else {
                $("#mowPatternItem").css("display", "none");
            }
            canvas.renderAll();
        }

        function mowPattern(url) {
            fabric.util.loadImage(url, function(img) {
                mow_pattern.fill = new fabric.Pattern({
                    source: img,
                    offsetX: field.getBoundingRect().left * -1,
                    offsetY: field.getBoundingRect().top * -1,
                    repeat: "no-repeat"
                });
                canvas.renderAll();
            });
        }

        function calculateWeather() {
            var carry = 0;
            $("#avgTemp").val(((parseInt($("#AprTemp").val()) + parseInt($("#MayTemp").val()) + parseInt($("#JunTemp").val()) + parseInt($("#JulTemp").val()) + parseInt($("#AugTemp").val()) + parseInt($("#SepTemp").val())) / 6).toFixed(1));
            $("#avgRain").val(((parseInt($("#AprRain").val()) + parseInt($("#MayRain").val()) + parseInt($("#JunRain").val()) + parseInt($("#JulRain").val()) + parseInt($("#AugRain").val()) + parseInt($("#SepRain").val())) / 6).toFixed(1));
            $("#Ambient").val(((((30.5 - parseInt($("#avgRain").val())) * parseInt($("#avgTemp").val())) + (parseInt($("#avgRain").val()) * (parseInt($("#avgTemp").val()) + 5))) / 30.5).toFixed(1));
            if ($("#ballparkType").val() == "1") {
                var carry = Math.round(((parseInt($("#Ambient").val()) - 67) / 2));
            }
            $("#carL").val(carry);
            $("#carC").val(carry);
            $("#carR").val(carry);
            calculateFactors();
        }

        function calculateFactors() {
            ipcRenderer.send('calculate-factors', {
                ballparkType: parseInt($("#ballparkType").val()),
                ballparkSurface: $("#ballparkSurface").val(),
                ballparkFoulArea: parseInt($("#ballparkFoulArea").val()),
                ballparkAltitude: parseInt($("#ballparkAltitude").val()),
                leftLine: parseInt($("#leftLine").val()),
                leftField: parseInt($("#leftField").val()),
                leftCenter: parseInt($("#leftCenter").val()),
                centerField: parseInt($("#centerField").val()),
                rightCenter: parseInt($("#rightCenter").val()),
                rightField: parseInt($("#rightField").val()),
                rightLine: parseInt($("#rightLine").val()),
                leftLineWall: parseInt($("#leftLineWall").val()),
                leftFieldWall: parseInt($("#leftFieldWall").val()),
                leftCenterWall: parseInt($("#leftCenterWall").val()),
                centerFieldWall: parseInt($("#centerFieldWall").val()),
                rightCenterWall: parseInt($("#rightCenterWall").val()),
                rightFieldWall: parseInt($("#rightFieldWall").val()),
                rightLineWall:parseInt($("#rightLineWall").val()),
                carL: parseInt($("#carL").val()),
                carC: parseInt($("#carC").val()),
                carR: parseInt($("#carR").val())
            })
        }

        ipcRenderer.on('calculate-factors-response', (event, data) => {
            $("#avgLHB").html(data.avgLHB);
            $("#avgLHBform").val(data.avgLHB);
            $("#avgRHB").html(data.avgRHB);
            $("#avgRHBform").val(data.avgRHB);
            $("#doubles").html(data.doubles);
            $("#doublesform").val(data.doubles);
            $("#triples").html(data.triples);
            $("#triplesform").val(data.triples);
            $("#hrLHB").html(data.hrLHB);
            $("#hrLHBform").val(data.hrLHB);
            $("#hrRHB").html(data.hrRHB);
            $("#hrRHBform").val(data.hrRHB);
        })
        
/*         $("#downloadPark").on("click",function(e) {
            e.preventDefault();
            canvas.renderAll();
            var fieldOptionItems = {};
            logoCanvas.deactivateAll().renderAll();
            var finalCanvas = document.getElementById('final');
            var exportCtx = finalCanvas.getContext('2d');
            exportCtx.clearRect(0,0,600,600);
            exportCtx.drawImage(document.getElementById("c"),0,0);
            exportCtx.drawImage(document.getElementById("c2"),0,0);
            var exportCanvas = document.getElementById("final");
            var dataURL = exportCanvas.toDataURL({format:"png"});
            dataURL = dataURL.substr(dataURL.indexOf(',') + 1).toString();  
            $("#ballparkInformation").attr("method","post");
            $("#ballparkInformation").attr("target","_blank");
            $("#ballparkInformation").attr("action","packagepark.php");
            switch ($("#playerCoordSelect").val()) {
                case "broadcastPlayers":
                    broadcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "broadcastBall":
                    broadcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastPlayers":
                    webcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastBall":
                    webcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
            }
            $("#canvasData").val(JSON.stringify(canvas.toJSON(['id','visible','selectable','perPixelTargetFind','centeredScaling','centeredRotation','borderColor','cornerColor','cornerSize','name','transparentCorners'])))
            $("#fillCanvasData").val(JSON.stringify(fillCanvas.toJSON(['id','visible','selectable','perPixelTargetFind','centeredScaling','centeredRotation','borderColor','cornerColor','cornerSize','name','transparentCorners'])))
            $("#logoCanvasData").val(JSON.stringify(logoCanvas.toJSON(['id','visible','selectable','perPixelTargetFind','centeredScaling','centeredRotation','borderColor','cornerColor','cornerSize','name','transparentCorners'])))
            $("#broadcastPlayerCoordinates").val(broadcastPlayers);
            $("#webcastPlayerCoordinates").val(webcastPlayers);
            $("#broadcastBallCoordinates").val(broadcastBall);
            $("#webcastBallCoordinates").val(webcastBall);
            $("#frmImageData").val(dataURL);
            $("div.fieldOption").each(function(e) {
                fieldOptionItems[$(this).attr("id")] = $(this).is(':visible');
            })
            fieldOptionItems[$("#onDeckCirclesItem").attr("id")] = $("#onDeckCirclesItem").is(':visible');
            $("#fieldOptionItems").val(JSON.stringify(fieldOptionItems));
            //$("#ballparkInformation").submit();
        }) */
        
        $("#ballparkInformation").submit(function(e) {
            e.preventDefault()
            $(".pleaseWait").html("Preparing Park...");    
            $(".overlay").css("display","table");
            $.ajax({
                type: "POST",
                url: "http://127.0.0.1:"+port+"/downloadBallpark",
                data: $("#ballparkInformation").serialize(),
                success: function(data) {  
                    if (data == "success") {
                        $(".overlay").css("display","none");
                    } else {
                        $(".overlay").css("display","none");
                        alert("An error occurred trying to generate the park file.\n\n"+data)
                    }
                },
                failure: function(data) {
                    $(".overlay").css("display","none");
                    alert("An error occurred trying to generate the park file.\n\n"+data)
                }
            })
            return true;
        });
		
		$("#downloadParkOriginal").on("click",function(e) {
			e.preventDefault();
            canvas.renderAll();
            var fieldOptionItems = {};
            logoCanvas.deactivateAll().renderAll();
            var finalCanvas = document.getElementById('final');
            var exportCtx = finalCanvas.getContext('2d');
            exportCtx.clearRect(0,0,600,600);
            exportCtx.drawImage(document.getElementById("c"),0,0);
            exportCtx.drawImage(document.getElementById("c2"),0,0);
            var exportCanvas = document.getElementById("final");
            var dataURL = exportCanvas.toDataURL({format:"png"});
            dataURL = dataURL.substr(dataURL.indexOf(',') + 1).toString();  
            //$("#ballparkInformation").attr("method","post");
            //$("#ballparkInformation").attr("target","_blank");
            //$("#ballparkInformation").attr("action","packagepark2.php");
            //$("#ballparkInformation").attr("action","http://127.0.0.1:"+port+"/downloadBallpark");
            switch ($("#playerCoordSelect").val()) {
                case "broadcastPlayers":
                    broadcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "broadcastBall":
                    broadcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastPlayers":
                    webcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastBall":
                    webcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
            }
            $("#canvasData").val("")
            $("#fillCanvasData").val("")
            $("#logoCanvasData").val("")
            $("#broadcastPlayerCoordinates").val(broadcastPlayers);
            $("#webcastPlayerCoordinates").val(webcastPlayers);
            $("#broadcastBallCoordinates").val(broadcastBall);
            $("#webcastBallCoordinates").val(webcastBall);
            $("#frmImageData").val(dataURL);
            $("div.fieldOption").each(function(e) {
                fieldOptionItems[$(this).attr("id")] = $(this).is(':visible');
            })
            fieldOptionItems[$("#onDeckCirclesItem").attr("id")] = $("#onDeckCirclesItem").is(':visible');
            $("#fieldOptionItems").val(JSON.stringify(fieldOptionItems));
            //$("#ballparkInformation").submit();
            //console.log(convertFormToJSON($("#ballparkInformation")))
            ipcRenderer.send('save-ballpark',convertFormToJSON($("#ballparkInformation")))
        })
        
        document.getElementById('uploadedImg').onchange = function handleImage(e) {
            var reader = new FileReader();
            reader.onload = function (event) {
                var imgObj = new Image();
                imgObj.src = event.target.result;
                imgObj.onload = function () {
                    var image = new fabric.Image(imgObj);
                    image.set({
                        originX: 'center',
                        originY: 'center',
                        left: 300,
                        top: 300,
                        opacity: 0.75,
                        perPixelTargetFind: true,
                        centeredScaling: true,
                        centeredRotation: true,
                        borderColor: 'red',
                        cornerColor: 'yellow',
                        cornerSize: 12,
                        transparentCorners: false,
                        id: $("#uploadedImg").val().split('\\').pop()
                    });
                    image.clipTo = function(ctx) {
                        ctx.save();
                        ctx.setTransform(1, 0, 0, 1, 0, 0);
                        clippingPath.render(ctx);
                        ctx.restore();
                    };
                    image.resizeFilters.push(new fabric.Image.filters.Resize({
                        resizeType: 'lanczos', // typo fixed
                        lanczosLobes: 3 // typo fixed
                    }));
                    logoCanvas.add(image);
					wallPoints.bringToFront();
                    logoCanvas.renderAll();
                    imgTop = image.get('top');
                    imgLeft = image.get('left');
                }
                
            }
            reader.readAsDataURL(e.target.files[0]);
        }
        
        document.getElementById('uploadedPattern').onchange = function handleImage(e) {
            var reader = new FileReader();
            reader.onload = function (event) {
                var imgObj = new Image();
                imgObj.src = event.target.result;
                imgObj.onload = function() {
                    $("#customMowPattern").val(imgObj.src);
                    $("#mow_pattern option[value='"+imgObj.src+"']").prop('selected', true);
                    $("#customMowPatternControl").css("display","inline-block");
                    mowPattern(imgObj.src);
                    $("#mowPatternOpacitySlider").val(mow_pattern.opacity*100);
                    $("#mowPatternOpacityValue").html(mow_pattern.opacity*100);
                }
            }
            reader.readAsDataURL(e.target.files[0]);
        }
    
        $("#showPlayers").on("click",function(e) {
            logoCanvas.deactivateAll().renderAll();
            if ($(this).val() == "Edit Player & Ball Locations") {
                $(".addMowPattern").prop("disabled",true);
                $("#addImage").prop("disabled",true);
                $(".factorHeader, .factorFooter").css("display","none");
                $("#coordinateContainerDiv").removeClass("noEvent");
                $("#coordinateContainerDiv").css("display","inline-block");
                $(".xy").each(function(e) {
                    if ($(this).hasClass($("#playerCoordSelect").val())) {
                        $(this).css("display","block");
                    } else {
                        $(this).css("display","none")
                    }
                })
                $("#playerCoordinatesFieldset").css("display","block");
                $(".weatherFieldset").css("display","none");
                $(this).val("Edit Weather Information");
                switch ($("#playerCoordSelect").val()) {
                    case "broadcastPlayers":
                        coordinateCanvas.setWidth('800');
                        break;
                    case "broadcastBall":
                        coordinateCanvas.setWidth('800');
                        break;
                    case "webcastPlayers":
                        coordinateCanvas.setWidth('600');
                        break;
                    case "webcastBall":
                        coordinateCanvas.setWidth('600');
                        break;
                    default:
                        coordinateCanvas.setWidth('800');
                }
                if ($("#playerCoordSelect").val().indexOf("broadcast") > -1) {
                    if ($("#ballparkType").val() == "3") {
                        $("#attribution").html("Image by Wikipedia user Dlz28")
                        $("#bgImageDiv").removeClass("webcast").removeClass("broadcast").addClass("broadcast_dome");
                    } else {
                        $("#attribution").html("\"Rule of Thirds\" by Stuart Seeger, used under CC BY / Cropped from original");
                        $("#bgImageDiv").removeClass("webcast").removeClass("broadcast_dome").addClass("broadcast")
                    }
                } else {
                    $("#attribution").html("");
                    $("#bgImageDiv").removeClass("broadcast").removeClass("broadcast_dome").addClass("webcast");
                }
                $("#bgImageContainerDiv").css("display","inline-block");
                coordinateCanvas.calcOffset();
                populateCanvas3($("#playerCoordSelect").val());
            } else {
                $(".addMowPattern").prop("disabled",false);
                $("#addImage").prop("disabled",false);
                $(".factorHeader, .factorFooter").css("display","inline-block");
                switch ($("#playerCoordSelect").val()) {
                    case "broadcastPlayers":
                        broadcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                        break;
                    case "broadcastBall":
                        broadcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                        break;
                    case "webcastPlayers":
                        webcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                        break;
                    case "webcastBall":
                        webcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                        break;
                }
                $("#bgImageContainerDiv").css("display","none");
                $("#coordinateContainerDiv").addClass("noEvent");
                $("#coordinateContainerDiv").css("display","none");
                $(".xy").each(function(e) {
                    if ($(this).hasClass($("#playerCoordSelect").val())) {
                        $(this).css("display","block");
                    } else {
                        $(this).css("display","none")
                    }
                })
                $("#playerCoordinatesFieldset").css("display","none");
                $(".weatherFieldset").css("display","block");
                $(this).val("Edit Player & Ball Locations");
                logoCanvas.calcOffset();
            }
        })
        
        coordinateCanvas.on('object:selected', function(e) {
            e.target.bringToFront();
            $(".xCoord, .yCoord").each(function() {
                $(this).css("background-color","white");
            })
            $("#"+e.target.xID).css("background-color","yellow");
            $("#"+e.target.yID).css("background-color","yellow");
        })
        
        coordinateCanvas.on('selection:cleared', function(e) {
            $(".xCoord, .yCoord").each(function() {
                $(this).css("background-color","white");
            })
        })

        coordinateCanvas.on('object:modified', function(e) {
            var obj = e.target;
            var inputTop;
            var inputLeft;

            switch ($("#playerCoordSelect").val()) {
                case "broadcastPlayers":
                    broadcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "broadcastBall":
                    broadcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastPlayers":
                    webcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastBall":
                    webcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
            }

            if ($("#"+obj.get('xID')).hasClass("640")) {
                inputTop = Math.round(parseFloat(obj.get('top')/1.25));
                inputLeft = Math.round(parseFloat(obj.get('left')/1.25));
            } else {
                inputTop = Math.round(parseFloat(obj.get('top')));
                inputLeft = Math.round(parseFloat(obj.get('left')));
            }
            $("#"+obj.get('xID')).val(inputLeft);
            $("#"+obj.get('yID')).val(inputTop);
        })

        $("#playerCoordSelect").on("change",function(e) {
            switch ($(this).data("prev")) {
                case "broadcastPlayers":
                    broadcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "broadcastBall":
                    broadcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastPlayers":
                    webcastPlayers = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
                case "webcastBall":
                    webcastBall = JSON.stringify(coordinateCanvas.toJSON(['id','xID','yID','hasBorders','borderColor','hasControls']));
                    break;
            }
            $(this).data("prev",$(this).val());
            $(".xy").each(function(e) {
                if ($(this).hasClass($("#playerCoordSelect").val())) {
                    $(this).css("display","block");
                } else {
                    $(this).css("display","none")
                }
            })
            if ($(this).val().indexOf("broadcast") > -1) {
                $("#tipContainerDiv").removeClass("tipContainer600").addClass("tipContainer800");
                if ($("#ballparkType").val() == "3") {
                    $("#attribution").html("Image by Wikipedia user Dlz28")
                    $("#bgImageDiv").removeClass("webcast").removeClass("broadcast").addClass("broadcast_dome");
                } else {
                    $("#attribution").html("\"Rule of Thirds\" by Stuart Seeger, used under CC BY / Cropped from original");
                    $("#bgImageDiv").removeClass("webcast").removeClass("broadcast_dome").addClass("broadcast")
                }
            } else {
                $("#tipContainerDiv").removeClass("tipContainer800").addClass("tipContainer600");
                $("#attribution").html("");
                $("#bgImageDiv").removeClass("broadcast").removeClass("broadcast_dome").addClass("webcast");
            }            
            populateCanvas3($(this).val());
        })

        function populateCanvas3(jsonString) {
            var foo;
            var mod = 1;
            switch (jsonString) {
                case "broadcastPlayers":
                    foo = broadcastPlayers;
                    mod = 1.25;
                    coordinateCanvas.setWidth('800');
                    break;
                case "broadcastBall":
                    foo = broadcastBall;
                    mod = 1.25;
                    coordinateCanvas.setWidth('800');
                    break;
                case "webcastPlayers":
                    foo = webcastPlayers;
                    coordinateCanvas.setWidth('600');
                    break;
                case "webcastBall":
                    foo = webcastBall;
                    coordinateCanvas.setWidth('600');
                    break;
                default:
                    foo = broadcastPlayers;
                    mod = 1.25;
                    coordinateCanvas.setWidth('800');
            }
            coordinateCanvas.calcOffset();
            coordinateCanvas.loadFromJSON(foo, function() {
                coordinateCanvas.renderAll();
            });

            var objects = coordinateCanvas.getObjects();

            for (x in objects) {
                $("#"+objects[x].get('xID')).val(Math.round((parseFloat(objects[x].get('left')/mod))));
                $("#"+objects[x].get('yID')).val(Math.round((parseFloat(objects[x].get('top')/mod))));
            }
        }

        $(document).on("change",".xCoord, .yCoord",function(e) {
            var mod = 1;
            if ($(this).hasClass("640")) {
                var mod = 1.25;
            } 
            var object = coordinateCanvas.getItemByID($(this).data('id'));
            coordinateCanvas.setActiveObject(object);
            if ($(this).hasClass("xCoord")) {
                object.setLeft(parseInt($(this).val()*mod));
            } else {
                object.setTop(parseInt($(this).val()*mod));
            }
            coordinateCanvas.renderAll()
        })

        function isOdd(num) { 
            return (num%2) == 0;
        }

        fabric.Canvas.prototype.getItemByID = function(id) {
          var object = null,
              objects = this.getObjects();

          for (var i = 0, len = this.size(); i < len; i++) {
            if (objects[i].get('id') && objects[i].get('id') === id) {
              object = objects[i];
              break;
            }
          }

          return object;
        };

        $("#resetCoordinates").on("click", function(e) {
            var coords;
            var mod = 1;
            switch ($("#playerCoordSelect").val()) {
                case "broadcastPlayers":
                    mod = 1.25;
                    coords = broadcastPlayersOriginal;
                    break;
                case "broadcastBall":
                    mod = 1.25;
                    coords = broadcastBallOriginal;
                    break;
                case "webcastPlayers":
                    coords = webcastPlayersOriginal;
                    break;
                case "webcastBall":
                    coords = webcastBallOriginal;
                    break;
            }
            coordinateCanvas.loadFromJSON(coords, function() {
                coordinateCanvas.renderAll();
            });

            var objects = coordinateCanvas.getObjects();

            for (x in objects) {
                $("#"+objects[x].get('xID')).val(Math.round((parseFloat(objects[x].get('left')/mod))));
                $("#"+objects[x].get('yID')).val(Math.round((parseFloat(objects[x].get('top')/mod))));
            }
        })

        coordinateCanvas.on("object:moving", function(e) {
            var inputTop;
            var inputLeft;
            var obj = e.target;
            if ($("#"+obj.get('xID')).hasClass("640")) {
                inputTop = Math.round(parseFloat(obj.get('top')/1.25));
                inputLeft = Math.round(parseFloat(obj.get('left')/1.25));
            } else {
                inputTop = Math.round(parseFloat(obj.get('top')));
                inputLeft = Math.round(parseFloat(obj.get('left')));
            }
            $("#"+obj.get('xID')).val(inputLeft);
            $("#"+obj.get('yID')).val(inputTop);
        });

        $("#uploadPark").on("click",function(e) {
            $("#loadPark").click();
        })

        document.getElementById('loadPark').onchange = function uploadFile(e) {
            if (this.files[0].name.substr(this.files[0].name.length - 4) != ".bpk") {
                alert("This does not appaer to be a valid park file.");
                return false;
            }
            
			$(".pleaseWait").html("Loading Park...");    
            $(".overlay").css("display","table");
			
            var formData = new FormData();
            formData.append('file', this.files[0]);

            $.ajax({
                url : 'loadpark.php',
                type : 'POST',
                data : formData,
                processData: false,
                contentType: false,
                success : function(data) {
                    if (data == "Invalid file uploaded!") {
                        alert("Error: "+data);
						$(".overlay").css("display","none");
                        return false;
                    }
                    var array = JSON.parse(data);
                    var xml = array[7];
                    $('#ballparkInformation input[type="text"]').each(function(e) {
                        $(this).val($(xml).find($(this).attr("id")).text());
                    })
                    $('.genericNumber').each(function(e) {
                        $(this).val($(xml).find($(this).attr("id")).text());
                    })
                    $("#ballparkType").val($(xml).find("ballparkType").attr("typeID"));
                    $("#ballparkSurface").val($(xml).find("ballparkSurface").attr("surfaceID"));
                    $("#ballparkFoulArea").val($(xml).find("ballparkFoulArea").attr("id"));
                    $('.distance').each(function(e){
                        var loc = $(this).data('location');
                        $(this).val($(xml).find('dimension').filter(function() { return $(this).text() == loc; }).attr('distance'))
                    })
                    $('.height').each(function(e){
                        var loc = $(this).data('location');
                        $(this).val($(xml).find('dimension').filter(function() { return $(this).text() == loc; }).attr('height'))
                    })
                    $('.temperature').each(function(e){
                        var month = $(this).data('month');
                        $(this).val($(xml).find('month').filter(function() { return $(this).text() == month; }).attr('temperature'))
                    })
                    $('.rain').each(function(e){
                        var month = $(this).data('month');
                        $(this).val($(xml).find('month').filter(function() { return $(this).text() == month; }).attr('precipitation'))
                    })
                    $("#avgWind").val($(xml).find('AverageWind').text());
                    calculateWeather();
                    canvas.loadFromJSON(array[0], canvas.renderAll.bind(canvas), function(o, object) {
                        canvas.add(object);
						if (object.id == "field") {
							clippingPath.path = object.path;
						}
                    })
                    fillCanvas.loadFromJSON(array[1], fillCanvas.renderAll.bind(fillCanvas), function(o, object) {
                        fillCanvas.add(object);
                    })
                    logoCanvas.loadFromJSON(array[2], logoCanvas.renderAll.bind(logoCanvas), function(o, object) {
                        logoCanvas.add(object);
                    })
                    coordinateCanvas.loadFromJSON(array[3], coordinateCanvas.renderAll.bind(coordinateCanvas), function(o, object) {
                        coordinateCanvas.add(object);
                    })
                    broadcastPlayers = array[3];
                    webcastPlayers = array[4];
                    broadcastBall = array[5];
                    webcastBall = array[6];
                    $("div.fieldOption").each(function(e) {
                        if ($(xml).find('FieldOptionVisibility '+$(this).attr("id")).text() == "visible") {
                            $(this).css("display","inline-block");
                        } else {
                            $(this).css("display","none");
                        }
                    })
                    if ($(xml).find('FieldOptionVisibility onDeckCirclesItem' == "visible")) {
                        $("#onDeckCirclesItem").css("display","inline-block");
                    } else {
                        $("#onDeckCirclesItem").css("display","none");
                    }
					$("#mow_pattern option[value='"+$(xml).find("FieldOptions mowPattern").text()+"']").prop('selected', true);
					$("#pitchingLane option[value='"+$(xml).find("FieldOptions pitchingLane").text()+"']").prop('selected', true);
					$("#infieldType option[value='"+$(xml).find("FieldOptions infieldType").text()+"']").prop('selected', true);
					$("#distanceMarkers option[value='"+$(xml).find("FieldOptions distanceMarkers").text()+"']").prop('selected', true);
					$("#onDeckCircles option[value='"+$(xml).find("FieldOptions onDeckCircles").text()+"']").prop('selected', true);
 
                    $.ajax({
                        url: 'populatefields.php',
                        type: 'POST',
                        data: {'country':$(xml).find("ballparkCountry").text(),'state':$(xml).find("ballparkState").text(),'city':$(xml).find("ballparkCity").text()},
                        success: function(data) {
                            array = JSON.parse(data);
                            $("#ballparkState option").each(function() {
                                $(this).remove();
                            });
                            $("#ballparkCity option").each(function() {
                                $(this).remove();
                            });
                            if (parseInt(array[0]['States']) > 0) {
                                $("#ballparkState").prop("disabled",false);
                                $('#ballparkState').append($("<option></option>").attr("value","").text("Select A State/Province")); 
                                for (x in array[2]) {
                                    $('#ballparkState').append($("<option></option>").attr("value",array[2][x]).text(array[2][x])); 
                                }
                            } else {
                                $("#ballparkState").prop("disabled",true);
                            }
                            $("#ballparkCity").prop("disabled",false);
                            $('#ballparkCity').append($("<option></option>").attr("value","").text("Select A City")); 
                            for (x in array[3]) {
                                $('#ballparkCity').append($("<option></option>").attr("value",array[3][x]).text(array[3][x]));       
                            }
                            $('#ballparkCountry').val($(xml).find("ballparkCountry").text());
                            $('#ballparkState').val($(xml).find("ballparkState").text());
                            $('#ballparkCity').val($(xml).find("ballparkCity").text());
							generateField();
							$(".overlay").css("display","none");
                        }
                    })
                }
            });
            
        }
        
        $("#colorSquare").on("click",function(e) {
            $(this).removeClass("colorSquareSelected").addClass("colorSquareActive");
            var object = logoCanvas.getActiveObject();
            logoCanvas.deactivateAll().renderAll();
            logoCanvas.setActiveObject(object);
            logoCanvas.hoverCursor='url(./images/eyedropper.cur),default';
            logoCanvas.on('mouse:move', function(e) {
            //logoCanvas.on('object:over', function(e) {
                var mouse = logoCanvas.getPointer(e.e);
                var x = parseInt(mouse.x);
                var y = parseInt(mouse.y);
                var localMouse = object.getLocalPointer(e.e);
                var imageX = parseInt(localMouse.x);
                var imageY = parseInt(localMouse.y);
                $("#chosenCoordinates").html("(X:"+imageX+", Y:"+imageY+")");
                var px = c2.getImageData(x, y, 1, 1).data;
                var hex = rgb2hex(px[0],px[1],px[2]);
                var textColor = idealTextColor(hex);
                $("#xPos").html(x);
                $("#yPos").html(y);
                $("#colorSquare").css("background",hex);
                $("#colorSquare").css("color",textColor);
                $("#colorSquare").val(hex);
            });
        })
        
        logoCanvas.on("object:selected", function(e) {
            var activeObject = e.target;
            $("#optionsTitle").html("Image Options: "+activeObject.get('id'));          
            $("#fieldOptionContainer").css("display","none");
            $("#opacityControl").css("display","inline-block");
            var opacity = activeObject.opacity * 100;
            $("#opacitySlider").val(activeObject.opacity * 100);
            $("#opacityValue").html(activeObject.opacity * 100);
            imgTop = activeObject.get("top");
            imgLeft = activeObject.get("left");
        });
        
        logoCanvas.on("object:modified", function(e) {
            var activeObject = e.target;
            imgTop = activeObject.get("top");
            imgLeft = activeObject.get("left");
        })
        
        logoCanvas.on("selection:cleared", function(e) {
            $("#fieldOptionContainer").css("display","inline-block");
            $("#opacityControl").css("display","none");
            $("#optionsTitle").html("Field Options");
        })
        
        logoCanvas.on('mouse:move', function(e) {
            if (logoCanvas.hoverCursor != "move") {
                var mouse = logoCanvas.getPointer(e.e);
                var x = parseInt(mouse.x);
                var y = parseInt(mouse.y);
                var px = c2.getImageData(x, y, 1, 1).data;
                var hex = rgb2hex(px[0],px[1],px[2]);
                var textColor = idealTextColor(hex);
                $("#xPos").html(x);
                $("#yPos").html(y);
                $("#colorSquare").css("background",hex);
                $("#colorSquare").css("color",textColor);
                $("#colorSquare").val(hex);         
            }
        });
        
        logoCanvas.on("mouse:down",function(e) {
            if (logoCanvas.hoverCursor != "move") {
                $("#colorSquare").removeClass("colorSquareActive").addClass("colorSquareSelected");
                logoCanvas.hoverCursor='move';
                logoCanvas.off('mouse:move');
                var object = logoCanvas.getActiveObject();
                var mouse = object.getLocalPointer(e.e);
                var imageX = parseInt(mouse.x);
                var imageY = parseInt(mouse.y);
                $("#chosenCoordinates").html("(X:"+imageX+", Y:"+imageY+")");
                var mouse2 = logoCanvas.getPointer(e.e);
                var x = parseInt(mouse2.x);
                var y = parseInt(mouse2.y);
                var px = c2.getImageData(x, y, 1, 1).data;
                var hex = rgb2hex(px[0],px[1],px[2]);
                $("#xPos").html(imageX);
                $("#yPos").html(imageY);
                $(".removeColor, .replaceColor").each(function(e) {
                    $(this).data("x",imageX);
                    $(this).data("y",imageY);
                })
            }       
        })
    
        $(".removeColor").on("click",function(e) {
            var x = $(this).data("x");
            var y = $(this).data("y");
            var action = $(this).attr("id");
            var color = $("#colorSquare").val();
            var fuzz = (parseInt($("#colorFuzz").val()))/100;
            if (action == "removeColorRange") {
                fuzz = parseInt($("#colorFuzz").val());
            }
            if (logoCanvas.getActiveObject()) {
                var object = logoCanvas.getActiveObject()
                if (object.get('type') == "image") {
                    $(".sample").css("display","inline-block");
                    var pictureName = object.get('id');
                    var opacity = object.get('opacity');
                    $("#colorSquare").removeClass("colorSquareActive").removeClass("colorSquareSelected");
                    var theImage = object._originalElement.currentSrc;
                    theImage = theImage.substr(theImage.indexOf(',') + 1).toString();           
                    $.ajax({
                        type: "POST",
                        url: "../scripts/changecolor.php",
                        data: {imgdata: theImage, x: x, y: y, color: color, action: action, fuzz: fuzz, filename: pictureName},
                        success: function(data) {
                            var imgObj = new Image();
                            imgObj.src = "data:image/png;base64,"+data;
                            imgObj.onload = function () {
                                var image = new fabric.Image(imgObj);
                                image.set({
                                    originX: 'center',
                                    originY: 'center',
                                    left: imgLeft,
                                    top: imgTop,
                                    perPixelTargetFind: true,
                                    centeredScaling: true,
                                    centeredRotation: true,
                                    borderColor: 'red',
                                    cornerColor: 'yellow',
                                    cornerSize: 12,
                                    id: pictureName,
                                    transparentCorners: false,
                                    opacity: opacity
                                });
                                image.clipTo = function(ctx) {
                                    ctx.save();
                                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                                    clippingPath.render(ctx);
                                    ctx.restore();
                                };
                                image.resizeFilters.push(new fabric.Image.filters.Resize({
                                    resizeType: 'lanczos',
                                    lanczosLobes: 2
                                }));
                                
                                image.on('object:modified',function() {
                                    imgLeft = image.get('left');
                                    imgTop = image.get('top');
                                });
                                
                                logoCanvas.remove(object);
                                logoCanvas.add(image);
								wallPoints.bringToFront();
                                logoCanvas.renderAll();
                                imgLeft = image.get('left');
                                imgTop = image.get('top');
                                $("#colorSquare").val("Select Color");
                                $("#colorSquare").css("background","#FFFFFF");
                                $("#colorSquare").css("color","#000000");
                                $(".sample").css("display","none");
                            }
                        }
                    })
                    return false;
                }
            }
        })
    
        $(".replaceColor").on("click",function(e) {
            $("#replaceColorSubmit").data("action",$(this).attr("id"))
            $("#replaceColorSubmit").data("x",$(this).data("x"))
            $("#replaceColorSubmit").data("y",$(this).data("y"))
            var color = $("#colorSquare").val();
            if ($("#replaceColorDiv").css("display") == "none") {
                $("#replaceColorDiv").slideToggle();
            }
        })
        
        $("#replaceColorSubmit").on("click",function(e) {
            var action = $(this).data("action");
            var x = $(this).data("x");
            var y = $(this).data("y");
            var color = $("#colorSquare").val();
            var newcolor = $("#replacementColor").spectrum("get").toHexString();
            var fuzz = (parseInt($("#colorFuzz").val()))/100;
            if (logoCanvas.getActiveObject()) {
                var object = logoCanvas.getActiveObject()
                if (object.get('type') == "image") {
                    var pictureName = object.get('id');
                    var opacity = object.get('opacity');
                    $("#colorSquare").removeClass("colorSquareActive").removeClass("colorSquareSelected");
                    var theImage = object._originalElement.currentSrc;  
                    theImage = theImage.substr(theImage.indexOf(',') + 1).toString();
                    $.ajax({
                        type: "POST",
                        url: "../scripts/changecolor.php",
                        data: {imgdata: theImage, x: x, y: y, action: action, color: color, newcolor: newcolor, fuzz: fuzz, filename: pictureName},
                        success: function(data) {
                            //$("#testImage").attr("src","data:image/png;base64,"+data);
                            var imgObj = new Image();
                            imgObj.src = "data:image/png;base64,"+data;
                            imgObj.onload = function () {
                                var image = new fabric.Image(imgObj);
                                image.set({
                                    originX: 'center',
                                    originY: 'center',
                                    left: imgLeft,
                                    top: imgTop,
                                    perPixelTargetFind: true,
                                    centeredScaling: true,
                                    centeredRotation: true,
                                    borderColor: 'red',
                                    cornerColor: 'yellow',
                                    cornerSize: 12,
                                    id: pictureName,
                                    opacity: opacity,
                                    transparentCorners: false
                                });
                                image.clipTo = function(ctx) {
                                    ctx.save();
                                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                                    clippingPath.render(ctx);
                                    ctx.restore();
                                };
                                image.resizeFilters.push(new fabric.Image.filters.Resize({
                                    resizeType: 'lanczos',
                                    lanczosLobes: 2
                                }));
                                
                                image.on('object:modified',function() {
                                    imgLeft = image.get('left')
                                    imgTop = image.get('top');
                                });
                                
                                logoCanvas.remove(object);
                                logoCanvas.add(image);
								wallPoints.bringToFront();
                                logoCanvas.renderAll();
                                imgLeft = image.get('left')
                                imgTop = image.get('top');
                            }
                        }
                    })
                    return false;
                }
            }   
        })
        
        $("#border").on("click",function(e) {
            var action = $(this).data("action");
            var fuzz = parseInt($("#colorFuzz").val());;
            if (logoCanvas.getActiveObject()) {
                var object = logoCanvas.getActiveObject()
                if (object.get('type') == "image") {
                    var pictureName = object.get('id');
                    var opacity = object.get('opacity');
                    $("#colorSquare").removeClass("colorSquareActive").removeClass("colorSquareSelected");
                    var theImage = object._originalElement.currentSrc;  
                    theImage = theImage.substr(theImage.indexOf(',') + 1).toString();
                    $.ajax({
                        type: "POST",
                        url: "../scripts/changecolor.php",
                        data: {imgdata: theImage, x: "1", y: "1", action: "removeBorder", color: "null", newcolor: "null", fuzz: fuzz, filename: pictureName},
                        success: function(data) {
                            //$("#testImage").attr("src","data:image/png;base64,"+data);
                            var imgObj = new Image();
                            imgObj.src = "data:image/png;base64,"+data;
                            imgObj.onload = function () {
                                var image = new fabric.Image(imgObj);
                                image.set({
                                    originX: 'center',
                                    originY: 'center',
                                    left: imgLeft,
                                    top: imgTop,
                                    perPixelTargetFind: true,
                                    centeredScaling: true,
                                    centeredRotation: true,
                                    borderColor: 'red',
                                    cornerColor: 'yellow',
                                    cornerSize: 12,
                                    id: pictureName,
                                    opacity: opacity,
                                    transparentCorners: false
                                });
                                image.clipTo = function(ctx) {
                                    ctx.save();
                                    ctx.setTransform(1, 0, 0, 1, 0, 0);
                                    clippingPath.render(ctx);
                                    ctx.restore();
                                };
                                image.resizeFilters.push(new fabric.Image.filters.Resize({
                                    resizeType: 'lanczos',
                                    lanczosLobes: 2
                                }));
                                
                                image.on('object:modified',function() {
                                    imgLeft = image.get('left')
                                    imgTop = image.get('top');
                                });
                                
                                logoCanvas.remove(object);
                                logoCanvas.add(image);
								wallPoints.bringToFront();
                                logoCanvas.renderAll();
                                imgLeft = image.get('left')
                                imgTop = image.get('top');
                            }
                        }
                    })
                    return false;
                }
            }   
        })
        
        $(".resizeImage").on("click",function(e) {
            if ($(this).attr("id") == "outfieldLogo") {
                var top = field.getTop()-(field.getHeight()/2)+200;
                //var maxHeight = top;
                
                var object = logoCanvas.getActiveObject();
                object.scaleToHeight(field.getHeight()/3);
                object.setLeft(300);
                object.setTop(181);
                object.setCoords();
            }
            if ($(this).attr("id") == "plateLogo") {
                var bottom = field.getTop() + (field.getHeight()/2);
                var maxHeight = bottom - 500;
                var object = logoCanvas.getActiveObject();
                object.scaleToHeight(maxHeight-8);
                object.setLeft(300);
                object.setTop(bottom - (maxHeight/2));
                object.setCoords();
            }
            if ($(this).attr("id") == "1bFoulLogo") {
                var object = logoCanvas.getActiveObject();
                var width = object.getWidth();
                var height = object.getHeight();
                if (height > width) {
                    object.scaleToHeight(35);
                } else {
                    object.scaleToWidth(50);
                }
                object.setLeft(361);
                object.setTop(458);
                object.setAngle(315);
                object.setCoords();
            }
            if ($(this).attr("id") == "3bFoulLogo") {
                var object = logoCanvas.getActiveObject();
                var width = object.getWidth();
                var height = object.getHeight();
                if (height > width) {
                    object.scaleToHeight(35);
                } else {
                    object.scaleToWidth(50);
                }
                object.setLeft(239);
                object.setTop(458);
                object.setAngle(45);
                object.setCoords();
            }
			wallPoints.bringToFront();
            logoCanvas.renderAll();
        })

        $(".range").on("change",function(e) {
            var activeObject = logoCanvas.getActiveObject();
            $(this).parent().parent().find('.sliderValue').html($(this).val());
            if ($(this).attr("id") == "opacitySlider") {
                activeObject.set('opacity',parseInt($(this).val())/100);
                logoCanvas.renderAll();
            }
        })
        
        $(".range").on("mousewheel",function(event) {
            val = parseInt($(this).val()) + event.deltaY;
            $(this).val(val);
            $(this).change();       
        })
        
        $(".rangeButton").on("click",function(e) {
            var input;
            if ($(this).val() == "-") {
                input = $(this).next();
                val = parseInt(input.val()) - 1;
            } else if ($(this).val() == "+") {
                input = $(this).prev();
                val = parseInt(input.val()) + 1;
            }
            input.val(val);
            var element = input.attr("id");
            var span = $(this).data('span');
            $("#"+span).html(val);
            $("#"+element).change();
        })

        function rgb2hex(r,g,b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }
        
        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        }
        
        function idealTextColor(bgColor) {
            var nThreshold = 105;
            var components = getRGBComponents(bgColor);
            var bgDelta = (components.R * 0.299) + (components.G * 0.587) + (components.B * 0.114);
            return ((255 - bgDelta) < nThreshold) ? "#000000" : "#ffffff";   
        }
        
        function getRGBComponents(color) {       
            var r = color.substring(1, 3);
            var g = color.substring(3, 5);
            var b = color.substring(5, 7);
            return {
                R: parseInt(r, 16),
                G: parseInt(g, 16),
                B: parseInt(b, 16)
            };
        }
        
        function angle(cx, cy, ex, ey) {
            var dy = ey - cy;
            var dx = ex - cx;
            var theta = Math.atan2(dy, dx); // range (-PI, PI]
            theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
            //if (theta < 0) theta = 360 + theta; // range [0, 360)
            return theta;
        }

        function getDataUri(url, callback) {
            var image = new Image();
            
            image.onload = function () {
                var canvas = document.createElement('canvas');
                canvas.width = this.naturalWidth; // or 'width' if you want a special/scaled size
                canvas.height = this.naturalHeight; // or 'height' if you want a special/scaled size
                
                canvas.getContext('2d').drawImage(this, 0, 0);
                
                callback(canvas.toDataURL('image/png'));
            };
            
            image.src = url;
        }

        function convertFormToJSON(form) {
            return $(form)
            .serializeArray()
            .reduce(function (json, { name, value }) {
                json[name] = value;
                return json;
            }, {});
        }

    </script>
</html>